

è¿™å¥—è¯¾ç¨‹ä½¿ç”¨äº†å…è´¹çš„ç´ æè¿›è¡Œå¼€å‘

ä»£ç æ‰‹å†Œï¼šhttps://docs.unity3d.com/2022.2/Documentation/ScriptReference/

è§£å†³ä»£ç æ²¡æœ‰æ™ºèƒ½æç¤ºçš„é—®é¢˜ï¼šhttps://superliii.blog.csdn.net/article/details/110157060

### Playæ¨¡å¼

ç‚¹å‡»Unityçª—å£é¡¶éƒ¨ä¸­é—´çš„æ’­æ”¾æŒ‰é’®ï¼Œå°±ä¼šè¿›å…¥playæ¨¡å‹ï¼Œåœ¨è¿™é‡Œå¯ä»¥æµ‹è¯•æ¸¸ç©æ¸¸æˆ

playæ¨¡å¼ä¸­ï¼Œåœ¨Inspectorçª—å£ä¸­å¯¹ç‰©ä½“çš„æ‰€æœ‰æ›´æ”¹éƒ½ä¸ä¼šä¿å­˜ã€‚

å¯ä»¥è°ƒæ•´ä¸€ä¸‹è¿è¡Œæ¨¡å¼æ—¶çš„ç¼–è¾‘å™¨èƒŒæ™¯é¢œè‰²ã€‚æ–¹ä¾¿åŒºåˆ†æ˜¯å¦åœ¨playæ¨¡å¼ï¼Œé¿å…æ— æ•ˆä¿®æ”¹ã€‚

`Edit > Preferences`

![image-20230326224538603](./images/è¿è¡Œæ¨¡å¼çš„é¢œè‰²è®¾ç½®.png)

## å¯¼å…¥ç´ æ

è¿™æ¬¡å¯¼å…¥ç´ æä½¿ç”¨å…è´¹ç´ æå®˜ç½‘ä¸‹è½½çš„åŸç‰ˆç´ æã€‚

äººç‰©ç´ æï¼šhttps://brullov.itch.io/generic-char-asset 

åœºæ™¯ç´ æï¼šhttps://anokolisa.itch.io/sidescroller-pixelart-sprites-asset-pack-forest-16x16

ä¸‹è½½ä¸‹æ¥æ˜¯ä¸¤ä¸ªå‹ç¼©åŒ…

```
# äººç‰©ç´ æ
generic_char_v0.2.rar
# åœºæ™¯ç´ æ
Legacy-Fantasy - High Forest 2.0.rar
```

åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºå­˜æ”¾æ¸¸æˆç´ æçš„æ–‡ä»¶å¤¹`Assets/Art Assets`ã€‚

å°†ä¸¤ä¸ªç´ æè§£å‹æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚

```
Assets/Art Assets/
  |- generic_char_v0.2/
    |- png/
    |- guide
    |- guide_2
  |- Legacy-Fantasy - High Forest 2.3
    |- Assets/
    |- Background/
    |- Charater/
    |- HUD/
    ...
```

è€å¸ˆçš„è¯¾ç¨‹ä¸»è¦å¤šäº†è¿™ä¸¤å¼ å›¾ç‰‡ç´ æï¼Œä¸€ä¸ªæ˜¯å­—ç¬¦ç´ æ

<img src="./images/SignCharacters.png" alt="SignCharacters" style="zoom:200%;" />

å¦ä¸€ä¸ªæ˜¯æ¸¸æˆæŒ‰é’®ç´ æ:

<img src="./images/GameButtons.png" alt="GameButtons" style="zoom:200%;" />

è¿™ä¸¤ä¸ªç´ ææ”¾åœ¨åœ¨`Legacy-Fantasy - High Forest 2.3/HUD`æ–‡ä»¶å¤¹ä¸‹ï¼Œä¼šåœ¨æ¯”è¾ƒåæœŸçš„è¯¾ç¨‹ä¸­è¿›è¡Œä½¿ç”¨ã€‚







### å›¾ç‰‡åˆ‡å‰²

é…ç½®å›¾åƒï¼šç‚¹å‡»char_blue_1åï¼Œåœ¨å³ä¾§çš„Inspectorä¸­é…ç½®ï¼š

- **Sprite Mode**: Multiple
- **Pixels Per Unit**: 16
- **Filter Mode**: Point (no filter)
- **Compression**: None

> ğŸ“–**å‚æ•°è¯´æ˜**
>
> **Sprite Mode**: ä¸€å¼ å›¾ç‰‡æœ‰å¤šå°‘ä¸ªSpriteï¼Œå¦‚æœæ˜¯Singleï¼Œå°±è¡¨ç¤ºä¸€å¼ å›¾ç‰‡åªæœ‰ä¸€ä¸ªSprite
>
> **Pixels Per Unit**: æ¯ä¸€ä¸ªæ ¼å­é‡Œæœ‰å¤šå°‘ä¸ªåƒç´ ï¼Œæ ¼å­æŒ‡çš„æ˜¯Unityç•Œé¢ä¸­çš„å°æ­£æ–¹æ ¼å­ï¼Œä¼¼ä¹æ˜¯åƒç´ é£æ¸¸æˆç‰¹æœ‰çš„ã€‚è¿™ä¸ªé¡¹ç›®é‡Œçš„ç´ æéƒ½æ˜¯16x16çš„ã€‚
>
> **Filter Mode**: è¿‡æ»¤æ¨¡å¼ï¼Œå°†ä¸€å¼ å°å›¾åƒæ”¾å¤§æ—¶ï¼Œä½¿ç”¨ä¸´è¿‘ç‚¹å»è¡¥å……åƒç´ ã€‚å¯¹äºåƒç´ é£æ ¼çš„æ¸¸æˆï¼Œé€šå¸¸ä¼šé€‰æ‹©"Point (no filter)"ï¼Œè¿™æ ·å›¾ç‰‡ç¼©æ”¾æ—¶ï¼Œåƒç´ è¾¹ç¼˜ä¿æŒé”åˆ©ï¼Œä¸ä¼šè¢«å¹³æ»‘å¤„ç†ã€‚
>
> **Compression**ï¼šè¿™ä¸ªå‚æ•°å†³å®šäº†å›¾ç‰‡å¦‚ä½•è¢«å‹ç¼©ä»¥å‡å°‘å†…å­˜å ç”¨ã€‚å¯¹äºåƒç´ é£æ ¼çš„æ¸¸æˆï¼Œå¯ä»¥ç›´æ¥é€‰æ‹©ä¸è¿›è¡Œå‹ç¼©ã€‚

> ğŸ’¡**å¦‚ä½•ç†è§£Spriteï¼Ÿ**
>
> åœ¨è®¡ç®—æœºå›¾å½¢ä¸­ï¼Œ"Sprite"é€šå¸¸è¢«å®šä¹‰ä¸ºä¸€ä¸ªäºŒç»´ä½å›¾ï¼Œå¯ä»¥åœ¨å±å¹•ä¸Šè¿›è¡Œæ“ä½œå’ŒåŠ¨ç”»ã€‚åœ¨æ¸¸æˆå¼€å‘ä¸­ï¼Œ"Sprite"é€šå¸¸ç”¨äºè¡¨ç¤ºæ¸¸æˆä¸­çš„è§’è‰²ã€ç‰©ä½“æˆ–å…¶ä»–å…ƒç´ ã€‚Spriteå¯ä»¥åŒ…å«ä¸€ä¸ªå•ä¸€çš„å›¾åƒï¼Œä¹Ÿå¯ä»¥åŒ…å«ä¸€ä¸ªç”±å¤šä¸ªå›¾åƒç»„æˆçš„åŠ¨ç”»åºåˆ—ã€‚
>
> åœ¨Unityä¸­ï¼Œ"Sprite"æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨2Dæ¸¸æˆå¼€å‘ä¸­ã€‚ä¸€ä¸ªSpriteä¸»è¦åŒ…å«ä¸€ä¸ª2Då›¾åƒå’Œä¸€äº›å…³äºè¿™ä¸ªå›¾åƒçš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚å›¾åƒçš„å¤§å°ã€ä½ç½®ã€æ—‹è½¬ä¸­å¿ƒç‚¹ç­‰ã€‚ä½ å¯ä»¥åœ¨Unityä¸­åˆ›å»ºå’Œæ“ä½œSpriteï¼Œæ¯”å¦‚ç§»åŠ¨Spriteã€æ—‹è½¬Spriteã€æ”¹å˜Spriteçš„å¤§å°ç­‰ã€‚
>
> åœ¨ä¸­æ–‡ä¸­ï¼Œ"Sprite"ä¸€èˆ¬è¢«ç¿»è¯‘ä¸ºâ€œç²¾çµâ€ã€‚è¿™ä¸ªè¯æ¥è‡ªæ—©æœŸçš„ç”µè„‘å›¾å½¢æŠ€æœ¯ï¼Œå½“æ—¶äººä»¬æŠŠèƒ½å¤Ÿåœ¨å±å¹•ä¸Šç§»åŠ¨çš„å›¾åƒæ¯”å–»ä¸ºâ€œç²¾çµâ€ã€‚åœ¨ç°ä»£çš„æ¸¸æˆå¼€å‘ä¸­ï¼Œå°½ç®¡æŠ€æœ¯å·²ç»å‘å±•äº†å¾ˆå¤šï¼Œä½†æ˜¯è¿™ä¸ªè¯ä»ç„¶è¢«å¹¿æ³›ä½¿ç”¨ã€‚

åŸæ¥äººç‰©çš„åŠ¨ç”»éƒ½æ˜¯ç»˜åˆ¶åœ¨ä¸€å¼ å›¾ç‰‡é‡Œçš„ï¼Œç„¶åå¯ä»¥é€šè¿‡unityçš„åˆ‡å‰²å™¨æŠŠè¿™ä¸ªå›¾ç‰‡è¿›è¡Œåˆ‡å‰²ã€‚

é…ç½®å®Œæ¯•åç‚¹å‡»Sprite Editorè¿›è¡Œåˆ‡å‰²

![image-20230326231408308](./images/image-20230326231408308.png)

æ³¨æ„æ•°æ¸…æ¥šå®ƒæœ‰å¤šå°‘è¡Œï¼Œå¤šå°‘åˆ—ã€‚

ç„¶åå¸Œæœ›å›¾ç‰‡çš„é”šç‚¹åœ¨äººç‰©çš„è„šä¸Šã€‚

![image-20230326231458070](./images/image-20230326231458070.png)





æ–°å»ºè°ƒè‰²ç›˜ï¼Œæ”¾åœ¨Assetsç›®å½•ä¸‹ã€‚



Sprite Renderer

Spriteè¿™é‡Œå¯ä»¥é€‰æ‹©æ¸²æŸ“çš„å›¾ç‰‡ã€‚

Sorting Layer å¯ä»¥åˆ›å»ºå¤šä¸ªå›¾å±‚

Order in Layer ä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ’å¾—è¶Šé«˜ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸é€šè¿‡è¿™ç§æ–¹å¼è°ƒæ•´å›¾å±‚ã€‚

åˆ›å»ºæ–°çš„å›¾å±‚ï¼Œä¸‹æ–¹çš„å›¾å±‚ä¼šé®æŒ¡ä¸Šæ–¹çš„å›¾å±‚

<img src="./images/image-20230327204326252.png" alt="image-20230327204326252" style="zoom: 67%;" />



### æŠ€å·§

#### æ‰“å¼€Tile Paletteçª—å£

 `Window` -> `2D` -> `Tile Palette` ç“¦ç‰‡è°ƒè‰²ç›˜

#### å¿«é€Ÿæ“¦é™¤ç»˜åˆ¶å†…å®¹

Tile Palette ä½¿ç”¨çŸ©å½¢å·¥å…·ç»˜åˆ¶æ—¶ï¼ŒåŒæ—¶æŒ‰ä¸‹shiftç”»çŸ©å½¢å¯ä»¥æ“¦é™¤ç»˜åˆ¶çš„ä¸œè¥¿ã€‚

#### æ·»åŠ Tile Palette å…¶ä»–çš„å·¥å…·

`Edit` -> `Preferences` æŸ¥çœ‹ Tile Paletteï¼Œå¯ä»¥æ·»åŠ å·¥å…·

#### é€‰æ‹©Tileçš„å¿«æ·é”®

é€‰æ‹©Tile ç‚¹å‡»é”®ç›˜ä¸Šçš„ `[`é”®

#### å¦‚ä½•å…³æ³¨æ­£åœ¨ç»˜åˆ¶å“ªå±‚

åœ¨Sceneçª—å£ä¸­ï¼Œå¯ä»¥é€šè¿‡é€‰æ‹©Tilemap Focusæ¥ç¡®å®šè‡ªå·±å½“å‰æ­£åœ¨ç»˜åˆ¶å“ªä¸€å±‚ã€‚

### åˆ¶ä½œæœ‰è§„åˆ™çš„ç“¦ç‰‡

> éš¾åº¦ä¸å¤§ï¼Œä¸»è¦æ˜¯è€å¿ƒ

åˆ›å»º`Assets/Tiles/Rule Tiles`ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ”¾ç½®è‡ªå·±è‡ªå®šä¹‰çš„è§„åˆ™ç“¦ç‰‡

å³é”®è¯¥æ–‡ä»¶å¤¹ï¼Œé€‰æ‹©`create` -> `2D` -> `Tiles` -> `Rule Tile`ã€‚åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„è§„åˆ™ç“¦ç‰‡ã€‚

ç„¶åèµ·åä¸º`Ground 1`

é€‰ä¸­`Ground 1`åœ¨Inspectorçª—å£ä¸­å¯ä»¥é€‰æ‹©å®ƒé»˜è®¤çš„Spriteï¼ˆå°±æ˜¯æ˜¾ç¤ºåœ¨ç“¦ç‰‡è°ƒè‰²ç›˜çš„é»˜è®¤å›¾åƒï¼‰ã€‚

> å¯é€‰ï¼šå¯¹ä¹‹å‰åˆ‡å‰²å¥½çš„ç“¦ç‰‡è¿›è¡Œé‡å‘½åï¼Œæ–¹ä¾¿åé¢é€‰æ‹©

åœ¨Tiling Rulesä¸­è®¾ç½®è§„åˆ™

<img src="./images/image-20230328214934131.png" alt="image-20230328214934131" style="zoom:67%;" />

è®¾ç½®å¥½è§„åˆ™åï¼Œå°†Ground 1 æ‹–æ‹½åˆ° Tile Paletteä¸­çš„ç©ºç™½ä½ç½®å³å¯

<img src="./images/image-20230328215418087.png" alt="image-20230328215418087" style="zoom:67%;" />

### åˆ¶ä½œåŠ¨æ€æ•ˆæœçš„ç“¦ç‰‡

åˆ›å»º`Assets/Tiles/Animated Tiles`ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ”¾ç½®åŠ¨æ€çš„ç“¦ç‰‡

å³é”®`Create` -> `2D` -> `Tiles` -> `Animated Tile`

ä¿®æ”¹ä¸ºWaterFall Left

åœ¨å³è¾¹çš„çª—å£è®¾å®šåŠ¨ç”»

<img src="./images/image-20230328222054054.png" alt="image-20230328222054054" style="zoom:67%;" />

## Player äººç‰©åˆ›å»º

### 1.è®¾ç½®äººç‰©åŠåŸºæœ¬ç»„ä»¶

é¡¹ç›®ç›¸å…³è®¾ç½® `Edit` -> `Project Settings` -> `Physics 2D`

è¿™é‡Œå¯ä»¥çœ‹åˆ°é‡åŠ›ç­‰ç›¸å…³è®¾ç½®

æ·»åŠ ç»„ä»¶ï¼šInspector å†…çš„ Add componentï¼Œç»™Playerå¯¹è±¡åŠ ä¸Š`Rigidbody 2D`ç»„ä»¶å°±æœ‰äº†é‡åŠ›ã€‚

ä½†æ˜¯ç›®å‰è§’è‰²æ²¡æœ‰ç¢°æ’ä½“ï¼ŒåŠ ä¸Šäº†é‡åŠ›ç»„ä»¶ä¼šä¸€ç›´ä¸‹è½ã€‚

æ·»åŠ `Capsule Collider 2D`ç»„ä»¶ã€‚ç‚¹å‡»Edit Colliderå¯ä»¥ç¼–è¾‘ç¢°æ’ä½“ã€‚

æŒ‰ä½`ALT`é”®å¯ä»¥å›ºå®šä¸­å¿ƒè½´æ›´æ”¹ç¢°æ’ä½“å¤§å°ã€‚

> **èšç„¦ç‰©ä½“**ï¼šåœ¨Hierarchyçª—å£ä¸­é€‰æ‹©æŸä¸ªç‰©ä½“ï¼Œåœ¨Sceneçª—å£ä¸­æŒ‰ä¸‹é”®ç›˜F

#### ä¸ºç“¦ç‰‡æ·»åŠ ç¢°æ’ä½“

ç»™åœºæ™¯æ·»åŠ `Tilemap Collider 2D`ç»„ä»¶

ä½†æ˜¯ç°åœ¨çš„ç¢°æ’ä½“æ˜¯æ¯ä¸ªæ ¼å­ä¸€ä¸ªç¢°æ’ä½“ï¼Œéœ€è¦æŠŠå®ƒä»¬åˆå¹¶

ç»™åœºæ™¯æ·»åŠ `Composite Collider 2D`ç»„ä»¶ï¼Œæ·»åŠ åï¼Œå¯ä»¥å‹¾é€‰`Tilemap Collider 2D`ä¸­çš„Used By Compositeã€‚

#### ä¿®æ”¹Body Type

ç”±äºæ·»åŠ `Composite Collider 2D`ç»„ä»¶åï¼Œä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ª`Rigidbody 2D`ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶æ¨¡å‹è‡ªå¸¦é‡åŠ›ï¼Œæ‰€ä»¥åœºæ™¯ä¼šä¸€ç›´å¾€ä¸‹è½ã€‚

å› æ­¤éœ€è¦å°†è¯¥ç»„ä»¶çš„Body Typeè®¾ç½®ä¸ºStatic

#### é”å®šäººç‰©æ—‹è½¬

ä¸é”å®šçš„è¯ï¼Œäººç‰©å¯èƒ½ä¼šå€’ä¸‹æ¥

åœ¨äººç‰©çš„`Rigidbody 2D`ç»„ä»¶ä¸­ï¼Œè®¾ç½®`Constraints`ï¼Œé€‰ä¸Š`Freeze Rotation`é”å®šZè½´

#### Rigidbody 2Dçš„å…¶ä»–è®¾ç½®

Collision Detection ç¢°æ’æ£€æµ‹ï¼š

- Discrete ç¦»æ•£æ£€æµ‹
- Continuous è¿ç»­æ£€æµ‹ï¼Œç”±äºåé¢äººç‰©æœ‰çˆ¬å¢™ï¼Œç¢°æ’ç­‰æœºåˆ¶ï¼Œè®¾ç½®ä¸ºè¿ç»­æ£€æµ‹æ›´åŠ ç²¾ç¡®ã€‚

Interpolate æ’å€¼ï¼š

- interpolate
- extrapolate

æƒ³è¦äº†è§£ç»„ä»¶å„é¡¹å‚æ•°çš„å«ä¹‰ï¼Œå¯ä»¥ç‚¹å‡»ç»„ä»¶å³ä¸Šæ–¹çš„`?`

### 2.åˆ›å»ºåŠé…ç½®æ–°è¾“å…¥ç³»ç»Ÿ

#### å‡çº§input system

`Edit` -> `Project settings` 

æŸ¥çœ‹Playeré€‰é¡¹å¡ï¼ŒæŸ¥çœ‹Other Settingsï¼Œæ‰¾åˆ°`Api Compatibility Level`

é€‰æ‹©`.NET Framework`ï¼Œç­‰å¾…æ›´æ–°å®Œæ¯•å

å°†`Active Input Handling`ä¿®æ”¹ä¸º`Input System Package (New)`

![image-20230329185403397](./images/image-20230329185403397.png)

#### å®‰è£…æ–°input system

`Window` -> `Package Manager`

åœ¨è¯¥çª—å£å·¦ä¸Šè§’çš„Packagesä¸­é€‰æ‹©`Unity Registry`

åœ¨å³ä¸Šè§’çš„æœç´¢æ¡†ä¸­è¾“å…¥ `input`ï¼Œå³å¯æ‰¾åˆ°

ç‚¹å‡»install

![image-20230329185557379](./images/image-20230329185557379.png)

ä»£ç æ‰‹å†Œï¼šhttps://docs.unity3d.com/Packages/com.unity.inputsystem@1.5/manual/index.html

#### åˆ›å»ºinput systemçš„é…ç½®æ–‡ä»¶

åœ¨Settings æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹`Input System`

å³é”®è¿™ä¸ªæ–‡ä»¶å¤¹ `Create` -> `Input Actions` ï¼ˆåœ¨æœ€ä¸‹æ–¹ï¼‰åˆ›å»ºä¸€ä¸ªè¾“å…¥ç³»ç»Ÿï¼Œæ”¹åä¸º`InputControls`

åŒå‡»`InputControls`å³å¯æ‰“å¼€é…ç½®çª—å£ã€‚

åœ¨Action Mapsä¸­å¯ä»¥åˆ›å»ºAction mapï¼Œä½œç”¨æ˜¯åœ¨ä¸åŒçš„æ¡ä»¶ä¸‹åˆ‡æ¢è¾“å…¥ç³»ç»Ÿé…ç½®ã€‚

> æ¯”å¦‚åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­ï¼Œç”¨ä¸€å¥—è¾“å…¥ï¼Œåœ¨æš‚åœçš„æ—¶å€™ç”¨å¦ä¸€å¥—è¾“å…¥ã€‚

åˆ›å»ºä¸€ä¸ªåä¸º `Movement`çš„Actionã€‚

å°†`Action Type`æ”¹ä¸º`Value`ï¼Œè¡¨ç¤ºä»¥å€¼çš„æ–¹å¼æ£€æµ‹

å°†`Control Type`æ”¹ä¸º`Vector 2`ï¼Œè¡¨ç¤ºä»¥äºŒç»´å‘é‡çš„å½¢å¼æ§åˆ¶

ç‚¹å‡»Actionsçª—å£å³ä¸Šè§’çš„åŠ å·ï¼Œé€‰æ‹©`Add Up\Down\Left\Right Composite`ã€‚å¿«é€Ÿæ·»åŠ ç»‘å®šçš„æŒ‰é”®ã€‚

ç„¶ååœ¨å³ä¾§çš„Pathä¸­é€‰æ‹©è¦ç›‘å¬çš„æŒ‰é”®

![image-20230329190743567](./images/image-20230329190743567.png)

å¦‚æœè¦æ·»åŠ æ‰‹æŸ„

å¯ä»¥å…ˆç‚¹å‡»`Add Binding`ï¼Œåœ¨å³ä¾§çš„Pathä¸­é€‰æ‹©ï¼š`Gamepad` -> `Left Stick`

#### æ·»åŠ é…ç½®è¡¨

åœ¨çª—å£å³ä¸Šè§’é€‰æ‹©`Add Control Scheme`

åˆ†åˆ«åˆ›å»ºKeyboard å’Œ Gamepadï¼Œå…¶ä¸­Gamepadéœ€è¦é€‰æ‹©

![image-20230329191256706](./images/image-20230329191256706.png)

ç†Ÿæ‚‰å®Œæ¯•åï¼Œåé¢å…¶å®å¹¶æ²¡æœ‰ç”¨è¿™ä¸ªä¸œè¥¿ã€‚

æŠŠä¹‹å‰åˆ›å»ºçš„`InputControls`åˆ æ‰

<img src="./images/image-20230329191532060.png" alt="image-20230329191532060" style="zoom:67%;" />

#### è‡ªåŠ¨ç”Ÿæˆé…ç½®è¡¨

åœ¨Hierarchyä¸­ç‚¹å‡»Playerå¯¹è±¡ï¼Œç‚¹å‡»`Add Component`ï¼Œæœç´¢å¹¶é€‰æ‹©Player Input

ç„¶åç‚¹å‡»`Create Actions...`

é€‰æ‹©æ–‡ä»¶å¤¹`Settings/Input System`ï¼Œæ–‡ä»¶åæ”¹ä¸º`PlayerInputControl.inputactions`ã€‚ç‚¹å‡»ä¿å­˜

å¯ä»¥çœ‹åˆ°Unityå¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºå¥½äº†ä¸€ä¸ªç©å®¶è¾“å…¥æ§åˆ¶è¡¨

![image-20230329191909532](./images/image-20230329191909532.png)

å¯ä»¥æŠŠ`Action Maps`ä¸­çš„Playeræ”¹åä¸º`Gameplay`

åœ¨Player Inputç»„ä»¶ä¸­ï¼Œå°†Behaviorä¿®æ”¹ä¸º`Invoke Unity Events`

<img src="./images/image-20230329192150730.png" alt="image-20230329192150730" style="zoom:67%;" />

å¯ä»¥çœ‹åˆ°Eventsä¸­çš„ä¸€äº›ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥åœ¨é‡Œé¢æ·»åŠ æ–¹æ³•æ¥æ§åˆ¶è§’è‰²çš„è¡Œä¸ºã€‚

åœ¨è¿™ä¸ªé¡¹ç›®é‡Œä¸ç”¨ï¼Œåªæ˜¯åˆ©ç”¨è¿™ä¸ªç»„ä»¶å¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆå¥½`PlayerController`

ç°åœ¨åˆ æ‰Player Inputç»„ä»¶ã€‚

<img src="./images/image-20230329192350811.png" alt="image-20230329192350811" style="zoom:67%;" />

#### ä½¿ç”¨é…ç½®è¡¨

åœ¨`Project`ä¸­é€‰ä¸­`PlayerInputControl`

åœ¨`Inspector`ä¸­å‹¾é€‰`Generate C# Class`

<img src="./images/image-20230329192546525.png" alt="image-20230329192546525" style="zoom:67%;" />

å›åˆ°æˆ‘ä»¬ä¹‹å‰åˆ›å»ºå¥½çš„`PlayerController.cs`ï¼Œåœ¨é‡Œé¢ç¼–å†™ä»£ç ã€‚

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.InputSystem;

public class PlayerController : MonoBehaviour
{
    public PlayerInputControl inputControl;
    public Vector2 inputDirection;

    private void Awake()
    {
        inputControl = new PlayerInputControl();

    }

    private void OnEnable()
    {
        inputControl.Enable();
    }

    private void OnDisable()
    {
        inputControl.Disable();
    }

    private void Update() {
        inputDirection = inputControl.Gameplay.Move.ReadValue<Vector2>();

    }
}

```

éœ€è¦åˆ›å»ºä¸€ä¸ªVectorå˜é‡è¯»å–`Control Type`ä¸­è®¾ç½®çš„`Vector 2`å˜é‡ã€‚

![image-20230329194951240](./images/image-20230329194951240.png)

- æ‰³æ‰‹è¡¨ç¤ºå±æ€§
- æ­£æ–¹ä½“è¡¨ç¤ºæ–¹æ³•
- é—ªç”µè¡¨ç¤ºäº‹ä»¶

ä»£ç ç¼–å†™å®Œæ¯•åï¼Œå›åˆ°Sceneï¼Œç‚¹å‡»è¿è¡Œï¼Œè¿™æ—¶å€™å†æŒ‰WASDï¼Œinspectorçª—å£ä¸­çš„Input Directionå°±ä¼šæ”¹å˜äº†

<img src="./images/image-20230329195217407.png" alt="image-20230329195217407" style="zoom:67%;" />

### 3.äººç‰©ç§»åŠ¨å’Œç¿»è½¬

[Unity - Scripting API: Rigidbody2D (unity3d.com)](https://docs.unity3d.com/2022.2/Documentation/ScriptReference/Rigidbody2D.html)

ä¿®æ”¹ä»£ç 

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.InputSystem;

public class PlayerController : MonoBehaviour
{
    public PlayerInputControl inputControl;
    // è·å–åˆšä½“ç»„ä»¶
    private Rigidbody2D rb;

    public Vector2 inputDirection;

    // å®šä¹‰é€Ÿåº¦
    public float speed;

    private void Awake()
    {
        inputControl = new PlayerInputControl();
        rb = GetComponent<Rigidbody2D>();
    }

    private void OnEnable()
    {
        inputControl.Enable();
    }

    private void OnDisable()
    {
        inputControl.Disable();
    }

    private void Update() {
        inputDirection = inputControl.Gameplay.Move.ReadValue<Vector2>();

    }

    private void FixedUpdate() {
        Move();
    }

    public void Move() {
        // é»˜è®¤çš„yæ˜¯ -9.81
        rb.velocity = new Vector2(inputDirection.x * speed * Time.deltaTime, rb.velocity.y);

        // äººç‰©ç¿»è½¬
        int faceDir = (int)transform.localScale.x;
        if (inputDirection.x > 0)
            faceDir = 1;

        if (inputDirection.x < 0)
            faceDir = -1;

        transform.localScale = new Vector3(faceDir, 1, 1);
    }
}

```

æ ¸å¿ƒä»£ç 

#### è·å–åˆšä½“ç»„ä»¶

åˆå§‹åŒ–åˆšä½“ç»„ä»¶å¯¹è±¡`rb`

```c#
public class PlayerController : MonoBehaviour
{
    // è·å–åˆšä½“ç»„ä»¶
    private Rigidbody2D rb;
    private void Awake()
    {
        ...
        rb = GetComponent<Rigidbody2D>();
    }
    public void Move() {
        // é»˜è®¤çš„yæ˜¯ -9.81
        rb.velocity = new Vector2(inputDirection.x * speed * Time.deltaTime, rb.velocity.y);
}
```

#### ç¿»è½¬åŠŸèƒ½

```c#
    public void Move() {
        // äººç‰©ç¿»è½¬
        int faceDir = (int)transform.localScale.x;
        if (inputDirection.x > 0)
            faceDir = 1;

        if (inputDirection.x < 0)
            faceDir = -1;

        transform.localScale = new Vector3(faceDir, 1, 1);
    }
```

ç¿»è½¬åŠŸèƒ½ä¹Ÿå¯ä»¥ç”¨Sprite Rendererçš„Filpå‚æ•°å®ç°

```c#
public class PlayerController : MonoBehaviour
{
    // è·å–åˆšä½“ç»„ä»¶
    private SpriteRenderer sr;
    private void Awake()
    {
        ...
        sr = GetComponent<SpriteRenderer>();
    }
    public void Move() {
        // é»˜è®¤çš„yæ˜¯ -9.81
        if (inputDirection.x > 0)
            sr.flipX = false;

        if (inputDirection.x < 0)
            sr.flipX = true;
}
```

### 4.å®ç°äººç‰©è·³è·ƒ

#### é…ç½®è·³è·ƒçš„æŒ‰é’®

![image-20230329225345046](./images/image-20230329225345046.png)

#### ç»‘å®šè·³è·ƒæŒ‰é”®å’Œè·³è·ƒå‡½æ•°

```c#
// inputControl.Gameplay.Jump.canceled  æŒ‰é”®æ¾å¼€
// inputControl.Gameplay.Jump.started  æŒ‰é”®æŒ‰ä¸‹
// inputControl.Gameplay.Jump.performed  æŒ‰é”®æŒ‰ä½

public float jumpForce;
private void Awake()
{
    // ç»‘å®šè·³è·ƒå‡½æ•°
    inputControl.Gameplay.Jump.started += Jump;
}
private void Jump(InputAction.CallbackContext obj) {
    Debug.Log("JUMP");
    rb.AddForce(transform.up * jumpForce, ForceMode2D.Impulse);

}
```

#### å‚æ•°æç¤º

æ–¹ä¾¿æ˜¾ç¤ºï¼Œæ–¹ä¾¿ç®¡ç†

```c#
[Header("åŸºæœ¬å‚æ•°")]
// å®šä¹‰é€Ÿåº¦
public float speed;
public float jumpForce;
```

<img src="./images/image-20230329230420325.png" alt="image-20230329230420325" style="zoom:67%;" />

å‚æ•°é…ç½® ï¼š

- Jump Force 16.5
- Gravity Scale 4

### 5.ç‰©ç†ç¯å¢ƒç›‘æµ‹åŠç»˜åˆ¶

#### åˆ›å»ºç¢°æ’æ£€æµ‹è„šæœ¬

åˆ›å»ºæ–°C#æ–‡ä»¶`Scripts/Player/PhysicsCheck`ï¼Œå°†å…¶æŒ‚è½½åˆ°Playerå¯¹è±¡ä¸Š

[Unity - Scripting API: Physics2D (unity3d.com)](https://docs.unity3d.com/2022.2/Documentation/ScriptReference/Physics2D.html)

ç¢°æ’æ£€æµ‹ï¼Œå½“æ¥è§¦åˆ°åœ°é¢æ—¶ï¼Œä¸èƒ½è·³è·ƒã€‚

ä½†æ˜¯ç¢°å¢™è·Ÿç¢°åœ°é¢åˆæœ‰åŒºåˆ«ã€‚å¯ä»¥é€šè¿‡è®¾ç½®æ£€æµ‹ç‚¹çš„æ–¹å¼ï¼Œä¸‹è¾¹çš„æ£€æµ‹ç‚¹ç¢°æ’äº†ï¼Œè¯´æ˜æ¥è§¦çš„æ˜¯åœ°é¢ã€‚

è¿™æ¬¡ä½¿ç”¨çš„æ˜¯[OverlapCircle](https://docs.unity3d.com/2022.2/Documentation/ScriptReference/Physics2D.OverlapCircle.html)æ–¹å¼

> Checks if a Collider falls within a circular area.

å¯ä»¥å…³æ³¨ä¸€ä¸‹å®ƒçš„å‚æ•°

| å‚æ•°      | è¯´æ˜                                                         |
| --------- | ------------------------------------------------------------ |
| radius    | The radius of the circle.                                    |
| layerMask | Filter to check objects only on specific layers.             |
| minDepth  | Only include objects with a Z coordinate (depth) greater than or equal to this value. |
| maxDepth  | Only include objects with a Z coordinate (depth) less than or equal to this value. |
| point     | Centre of the circle.                                        |

æ³¨æ„layerMaskå‚æ•°ï¼Œé€šè¿‡è¯¥å‚æ•°å¯ä»¥åªæ£€æµ‹ç‰¹å®šå±‚çš„å¯¹è±¡ã€‚

ç¼–å†™PhysicsCheck

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PhysicsCheck : MonoBehaviour
{
    public bool isGround;
    // æ£€æµ‹åŠå¾„
    public float checkRadius;

    // 
    public LayerMask groundLayer;
    public void Check()
    {
        isGround = Physics2D.OverlapCircle(transform.position, checkRadius, groundLayer);
    }

    private void Update()
    {
        Check();
    }
}

```

#### è®¾ç½®layerMask

è¿™é‡Œéœ€è¦æ–°å»ºä¸€ä¸ªå±‚çº§ã€‚

<img src="./images/image-20230330220824555.png" alt="image-20230330220824555" style="zoom:67%;" />

è‡ªå·±åˆ›å»ºä¸€ä¸ªGroundå±‚çº§ï¼Œå¹¶æŠŠPlatformåŠ å…¥åˆ°è¿™ä¸ªå±‚çº§å†…ã€‚

ç„¶åå°±å¯ä»¥è®¾ç½®layerMaskäº†

<img src="./images/image-20230330220931474.png" alt="image-20230330220931474" style="zoom:67%;" />

#### å¦‚ä½•è°ƒç”¨è‡ªå·±å†™çš„å…¶ä»–è„šæœ¬

åœ¨PlayerControllerè„šæœ¬å†…

> æ³¨æ„è¿™é‡Œè¦ç”¨å…¬å¼€å˜é‡ï¼ˆwhyï¼Ÿï¼‰

```c#
public class PlayerController : MonoBehaviour
{
    // è·å–å¦ä¸€ä¸ªè„šæœ¬å¯¹è±¡
    private PhysicsCheck physicsCheck;
    // åœ¨Awakeä¸­è·å–
    private void Awake()
    {
        physicsCheck = GetComponent<PhysicsCheck>();
    }
    // ä¿®æ”¹åŸæ¥çš„è·³è·ƒå‡½æ•°
    private void Jump(InputAction.CallbackContext obj) {
        // Debug.Log("JUMP");
        if ()
        rb.AddForce(transform.up * jumpForce, ForceMode2D.Impulse);
        
    }
}
```



#### ç¢°æ’æ£€æµ‹èŒƒå›´å¯è§†åŒ–

ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯å‡­æ„Ÿè§‰è®¾ç½®ç¢°æ’æ£€æµ‹åŠå¾„ã€‚

Gizmoå¯ä»¥ç†è§£ä¸ºSceneåœºæ™¯ä¸­çš„è¾…åŠ©çº¿ã€‚

ä¿®æ”¹`PhysicsCheck.cs`

```c#
public class PhysicsCheck : MonoBehaviour
{
    // äººç‰©è„šåº•ä½ç§»æ’å€¼
    public Vector2 bottomOffset;
    
    // ...
    
    // Unityå†…ç½®çš„æ–¹æ³•ï¼Œç»˜åˆ¶åˆ°Sceneçª—å£å†…
    private void OnDrawGizmosSelected() {
        Gizmos.DrawWireSphere((Vector2)transform.position + bottomOffset, checkRadius)
    }
}
```

ä¿®æ”¹å®Œæ¯•åï¼Œä¸ä»…å¯ä»¥é€šè¿‡bottomOffsetè‡ªå®šä¹‰ç¢°æ’èŒƒå›´çš„ä½ç½®ï¼Œè¿˜èƒ½å¤Ÿæ˜¾ç¤ºç¢°æ’èŒƒå›´çš„å…·ä½“å¤§å°ã€‚

#### å®Œæ•´çš„PhysicsCheckä»£ç 

```c#
// PhysicsCheck.cs
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PhysicsCheck : MonoBehaviour
{
    [Header("æ£€æµ‹å‚æ•°")]
    // äººç‰©è„šåº•ä½ç§»æ’å€¼
    public Vector2 bottomOffset;

    public float checkRadius;

    // æ£€æµ‹çš„å±‚çº§
    public LayerMask groundLayer;

    [Header("çŠ¶æ€")]
    // æ£€æµ‹åŠå¾„
    public bool isGround;
    public void Check()
    {
        isGround = Physics2D.OverlapCircle((Vector2)transform.position + bottomOffset, checkRadius, groundLayer);
    }

    private void Update()
    {
        Check();
    }

    // Unityå†…ç½®çš„æ–¹æ³•ï¼Œç»˜åˆ¶åˆ°Sceneçª—å£å†…
    private void OnDrawGizmosSelected() {
        Gizmos.DrawWireSphere((Vector2)transform.position + bottomOffset, checkRadius);
    }
}

```

#### ä½¿äººç‰©ä¸è´´å¢™

éœ€è¦åˆ›å»ºä¸€ä¸ªå…‰æ»‘çš„ç‰©ç†æè´¨

åˆ›å»ºæ–‡ä»¶å¤¹`Settings/Physics Material`

å³é”®è¯¥æ–‡ä»¶å¤¹ `Create` -> `2D` -> `Physics Material 2D`

å°†å…¶æ‘©æ“¦åŠ›æ”¹ä¸º0

![image-20230330222150158](./images/image-20230330222150158.png)

åœ¨playerå¯¹è±¡ä¸­ï¼ŒæŠŠRigidbody 2Dçš„ Material æ”¹ä¸º Normal

### 6.åˆ›å»ºäººç‰©åŸºæœ¬åŠ¨ç”»

> åœ¨animatorçª—å£ä¸­æŒ‰Aå¯ä»¥è‡ªåŠ¨ç¼©æ”¾è°ƒæ•´åˆ°åˆé€‚çš„å¤§å°å’Œä½ç½®

å¯ä»¥æŸ¥çœ‹è¿™å¥—ç´ æçš„ä»‹ç»`Art Assets/Generic-Character`

![guide](./images/guide.png)

å¯ä»¥ç»™å„ä¸ªç´ ææ”¹ä¸‹åæ–¹ä¾¿æŸ¥æ‰¾

```
# å¾…æœºçŠ¶æ€
idle

```

ç»™Playerå¯¹è±¡æ·»åŠ Animatorç»„ä»¶

è¯¥ç»„ä»¶éœ€è¦åŠ¨ç”»æ§åˆ¶å™¨

åˆ›å»ºæ–°æ–‡ä»¶å¤¹

```
Assets
  Animations
    Player
```

å³é”®Playeræ–‡ä»¶å¤¹`Create` -> `Animator Controller`

> Animator Controller ä¸ Animation
>
> Animationæ˜¯ä¸€ä¸ªå•ä¸ªçš„åŠ¨ç”»ï¼ŒAnimator Controllerå¯ä»¥ç®¡ç†å¤šä¸ªåŠ¨ç”»

åˆ›å»ºå¥½Animator Controlleråï¼Œåœ¨Playerçš„Animatorç»„ä»¶ä¸­çš„Controllerå°±å¯ä»¥è®¾ç½®äº†ã€‚

æŸ¥çœ‹Animatoræ§åˆ¶å™¨ï¼š`Window` -> `Animation` -> `Animator`

![image-20230330232425349](./images/image-20230330232425349.png)

åˆ›å»ºåŠ¨ç”»

é€‰ä¸­Playerå¯¹è±¡ï¼Œåœ¨`Window` -> `Animation` -> `Animation`ï¼ˆæˆ–è€…ç›´æ¥ctrl + 6ï¼‰

![image-20230330232614522](./images/image-20230330232614522.png)

ä¼šéœ€è¦é€‰æ‹©åŠ¨ç”»ä¿å­˜çš„ä½ç½®ï¼Œå‘½åä¸º`BlueIdle.anim`ä¿å­˜åˆ°`Assets/Animations/Player`

> æ˜¾ç¤ºé‡‡æ ·ç‡ Samplesï¼Œåœ¨Animationçª—å£çš„å³ä¸Šè§’çš„ä¸‰ä¸ªç‚¹è®¾ç½®ã€‚

åˆ›å»ºæ–°çš„åŠ¨ç”»

<img src="./images/image-20230331192941584.png" alt="image-20230331192941584" style="zoom:67%;" />

æŒ‰ç…§ä¹‹å‰çš„æ–¹æ³•æŠŠè·‘æ­¥çš„åŠ¨ç”»åŠ è¿›å»ã€‚è·‘æ­¥çš„åŠ¨ç”»æ˜¯ç¬¬ä¸‰æ’ã€‚

ç„¶åå›åˆ°Animatorçª—å£ï¼Œè¯¥çª—å£ä¸‹å¯ä»¥çœ‹åˆ°æ–°å¢äº†ä¸€ä¸ªæ–¹å—ï¼Œè¿™é‡Œçš„æ–¹å—å°±ä»£è¡¨çŠ¶æ€ï¼Œæ¯”å¦‚`BlueIdle`çŠ¶æ€ï¼Œ`BlueRun`çŠ¶æ€ã€‚

å¯ä»¥å³é”®çŠ¶æ€ï¼Œæ·»åŠ çŠ¶æ€è½¬ç§»çº¿`Transition`

![image-20230331193714507](./images/image-20230331193714507.png)

åœ¨å³ä¾§å¯ä»¥è®¾ç½®è½¬ç§»çš„å…·ä½“è§„åˆ™ã€‚

è¿™é‡ŒExit Time è¡¨ç¤ºï¼Œå½“ç°åœ¨çš„åŠ¨ç”»è¿è¡Œäº† 58.33%çš„å¸§ä»¥åï¼ŒçŠ¶æ€è½¬ç§»ã€‚å¯ä»¥è°ƒæˆ1çœ‹çœ‹æ•ˆæœã€‚

#### è®¾ç½®äººç‰©è¿è¡Œè·‘æ­¥åŠ¨ç”»çš„æ¡ä»¶

åœ¨Animatorçª—å£å³ä¾§çš„Parameteré€‰é¡¹å¡ä¸­è®¾ç½®å‚æ•°`velocityX`

ç„¶ååœ¨çŠ¶æ€è½¬ç§»`Transition`è®¾ç½®ä¸­çš„ Conditions æ·»åŠ æ¡ä»¶ï¼Œè®¾ç½®å¤§äº0.1

<img src="./images/image-20230331194519120.png" alt="image-20230331194519120" style="zoom:67%;" />

å–æ¶ˆå‹¾é€‰ HasExitTimeï¼Œå–æ¶ˆå‹¾é€‰Fixed Duration ï¼ˆåŠ¨ç”»è¿‡æ¸¡æ•ˆæœï¼‰ï¼ŒTransition Duration è®¾ç½®ä¸º0

åŒæ—¶å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸‹ä»è·‘æ­¥çŠ¶æ€åˆ‡æ¢å›æ¥çš„æ–¹æ³•ã€‚



åœ¨ä»£ç ä¸­æ§åˆ¶velocityXçš„æ•°å€¼ï¼Œåˆ›å»ºæ–°çš„C#è„šæœ¬ï¼ŒPlayerAnimation

è¿™é‡Œå¯ä»¥å‚è€ƒä»£ç æ‰‹å†Œï¼š[Unity - Scripting API: Animator (unity3d.com)](https://docs.unity3d.com/2022.2/Documentation/ScriptReference/Animator.html)

äº†è§£å¦‚ä½•è·å–æµ®ç‚¹æ•°å˜é‡ï¼ˆ[GetFloat](https://docs.unity3d.com/2022.2/Documentation/ScriptReference/Animator.GetFloat.html)ï¼‰ï¼Œè®¾ç½®æµ®ç‚¹æ•°å˜é‡ï¼ˆ[SetFloat](https://docs.unity3d.com/2022.2/Documentation/ScriptReference/Animator.SetFloat.html)ï¼‰

ä»£ç å¦‚ä¸‹

```python
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerAnimation : MonoBehaviour
{
    // Start is called before the first frame update
    public Animator anim;

    public Rigidbody2D rb;
    private void Awake() {
        anim = GetComponent<Animator>();
        rb = GetComponent<Rigidbody2D>();
    }
    private void Update() {
        SetAnimation();
    }
    public void SetAnimation() {
        anim.SetFloat("velocityX", Mathf.Abs(rb.velocity.x));
    }
}

```

#### è‡ªæˆ‘ç»ƒä¹ ï¼šç”¨æŒ‰é”®åˆ‡æ¢äººç‰©è¡Œèµ°çŠ¶æ€

è€å¸ˆç”¨æ‰‹æŸ„å¯ä»¥æ§åˆ¶é€Ÿåº¦å¤§å°ã€‚

æˆ‘è¿™é‡Œç”¨æŒ‰é”®åˆ‡æ¢é€Ÿåº¦ã€‚æŒ‰shiftåˆ‡æ¢è·‘æ­¥å’Œè¡Œèµ°çŠ¶æ€ã€‚

ç”¨ç±»ä¼¼Jumpçš„æ–¹æ³•ï¼Œæ·»åŠ ä¸€ä¸ª`shift`æŒ‰é”®ã€‚ç„¶åä¿®æ”¹ä»£ç å³å¯

ä¿®æ”¹`PlayerController.cs`

```c#
public class PlayerController : MonoBehaviour
{
    [Header("è¡Œèµ°çŠ¶æ€")]
    private void Awake()
    {
        inputControl.Gameplay.Run.started += Run;
    }    
    private void Run(InputAction.CallbackContext obj) {
        if (isRun) 
        {
            speed = 150;
        }
        else
        {
            speed = 300;
        }
    }
}
```

æ”¹æˆæŒ‰ä½shifté”®æ˜¯å¥”è·‘

```c#
    private void Update() {
        if (inputControl.Gameplay.Run.inProgress) {
            speed = 300;
        }
        else {
            speed = 150;
        }
        
    }
```

### 7.äººç‰©è¡Œèµ°è®¾å®š

æŒ‰ä½shiftæ—¶ï¼Œäººç‰©æ˜¯è¡Œèµ°ï¼Œæ¾å¼€æ—¶æ˜¯è·‘æ­¥ã€‚

è·Ÿæˆ‘ä¸Šé¢è‡ªå·±ç»ƒä¹ çš„å†²çªäº†å•Šã€‚è¿™é‡Œå°±æŠŠä¹‹å‰æˆ‘ç»ƒä¹ æ—¶çš„æŒ‰é”®åˆ é™¤ã€‚ä»£ç ä¹Ÿæ³¨é‡Šæ‰ã€‚

```c#
    private void Awake()
    {
        // ...
        // inputControl.Gameplay.Run.started += Run;
    }
```



å¯ä»¥åœ¨`Settings/Input System/PlayInputControl`ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„æŒ‰é’®`WalkButton`

æ·»åŠ ç»‘å®šçš„æŒ‰é”® å·¦shifté”®ã€‚

æ€è·¯ï¼Œä¿å­˜å¥½åŸå§‹çš„è®¾å®šé€Ÿåº¦ï¼ŒæŒ‰ä½æŒ‰é’®æ—¶ï¼Œé€Ÿåº¦å‡åŠï¼Œæ¾å¼€æ—¶è¿˜åŸã€‚

ä»£ç å¦‚ä¸‹

```c#
public class PlayerController : MonoBehaviour
{
    // ...
    // ç”¨äºå­˜å‚¨è·‘æ­¥æ—¶çš„é€Ÿåº¦
    private float runSpeed;
    // => çš„å†™æ³•è¡¨ç¤ºè‡ªåŠ¨å±æ€§ï¼Œå¦‚æœspeedå˜åŒ–ï¼Œè¿™ä¸ªå±æ€§ä¹Ÿå˜åŒ–
    private float walkSpeed => speed / 2f;
    
    private void Awake()
    {
        // è¦åœ¨awake() é‡Œè·å–è¿™ä¸ªå€¼
        runSpeed = speed;

        #region å¼ºåˆ¶èµ°è·¯
        // è€å¸ˆåœ¨ InputAction.CallbackContext ctx çš„å·¦å³æ²¡æœ‰åŠ æ‹¬å·ï¼Œåº”è¯¥è·Ÿc#ç‰ˆæœ¬æœ‰å…³ã€‚
        inputControl.Gameplay.WalkButton.performed += (InputAction.CallbackContext ctx) => {
            if (physicsCheck.isGround)
                speed = walkSpeed;
        };

        inputControl.Gameplay.WalkButton.canceled += (InputAction.CallbackContext ctx) => {
            if (physicsCheck.isGround)
                speed = runSpeed;
        };
        #endregion
    }
```

`#region å¼ºåˆ¶èµ°è·¯ #endregion`çš„æ•ˆæœæ˜¯æ›´æ–¹ä¾¿æŠ˜å ä»£ç 

### 8.äººç‰©è·³è·ƒåŠ¨ç”»

#### è·³è·ƒåŠ¨ç”»åˆ›å»º

è¿™é‡Œè¦å­¦ä¹ Unityä¸­çš„æ–°çŸ¥è¯†ï¼šBlenderTreeæ··åˆæ ‘

è·³è·ƒåŠ¨ç”»æ˜¯åˆ†é˜¶æ®µçš„ï¼Œå¦‚ä¸‹å›¾

<img src="./images/image-20230402102353897.png" alt="image-20230402102353897" style="zoom:67%;" />

ä¸€å…±æœ‰5ä¸ªé˜¶æ®µ

å¯ä»¥åˆ†åˆ«å¯¹è¿™5ä¸ªé˜¶æ®µé‡å‘½åï¼Œæ–¹ä¾¿æŸ¥æ‰¾ï¼Œå‘½åæ ¼å¼å‚è€ƒï¼š`jump_1_1`

ç„¶ååˆ›å»ºå¥½è¿™5ä¸ªåŠ¨ç”»

<img src="./images/image-20230402103017091.png" alt="image-20230402103017091" style="zoom:67%;" />

è®¾ç½®å®Œæ¯•åä¼šçœ‹åˆ°animatorçª—å£åˆ›å»ºå¥½äº†5ä¸ªçŠ¶æ€ï¼Œè¿™æ—¶å€™ç°å°†è¿™äº”ä¸ªåŠ¨ç”»çŠ¶æ€åˆ é™¤ï¼Œç„¶ååˆ›å»ºBlenderTreeï¼Œå¹¶å°†è¿™ä¸ªBlender Treeé‡å‘½åä¸ºJump

![image-20230402103947953](./images/image-20230402103947953.png)

åŒå‡»Jumpï¼Œå¯ä»¥è¿›å…¥ç¼–è¾‘é¡µé¢ï¼Œç”±äºè·³è·ƒåŠ¨ç”»æ˜¯æ ¹æ®Yè½´é€Ÿåº¦æ¥çš„ï¼Œå› æ­¤éœ€è¦æ–°å¢ä¸€ä¸ªå˜é‡`velocityY`

ç„¶ååœ¨Inspectorçª—å£ä¸­æ·»åŠ 4ä¸ªåŠ¨ç”»ï¼Œåœ¨Animatorä¸­çš„æ•ˆæœå¦‚ä¸‹ï¼Œæ‹–åŠ¨velocityYæ»‘æ¡ï¼ŒåŠ¨ç”»å°±ä¼šè¿›è¡Œåˆ‡æ¢ã€‚

![image-20230402104842287](./images/image-20230402104842287.png)

åœ¨Rigidbodyä¸­è§‚å¯Ÿyè½´é€Ÿåº¦çš„å˜åŒ–ã€‚

ç„¶åå›åˆ°Blender Treeï¼Œä¿®æ”¹åŠ¨ç”»åˆ‡æ¢çš„Thresholdï¼Œå¦‚ä¸‹

<img src="./images/image-20230402105515511.png" alt="image-20230402105515511" style="zoom:67%;" />

æ¥ä¸‹æ¥è¿æ¥å‚æ•°å€¼åˆ°velocityYï¼Œåœ¨`PlayerAnimation.cs`ä¸­

```c#

public class PlayerAnimation : MonoBehaviour
{
    // Start is called before the first frame update
    public void SetAnimation() {
        anim.SetFloat("velocityX", Mathf.Abs(rb.velocity.x));
        anim.SetFloat("velocityY", rb.velocity.y);
    }
}

```

å›åˆ°Animatorçš„Base Layerï¼Œåˆ›å»ºæ–°çš„å‚æ•°isGround

ä»Any State è¿æ¥è½¬æ¢æ¡ä»¶åˆ° Jumpï¼Œå¹¶æ·»åŠ æ¡ä»¶isGroundä¸ºFalseæ—¶ï¼Œåˆ‡æ¢ä¸ºè·³è·ƒçŠ¶æ€ã€‚

å–æ¶ˆCan Transition To Selfï¼Œå¦åˆ™ä¼šæ— æ³•é€€å‡ºè¯¥çŠ¶æ€ã€‚

å°†è½åœ°åŠ¨ç”»é‡æ–°åŠ å›Animatorçª—å£ï¼Œç›´æ¥ä»`Assets/Animations/Player/BlueLand`ä¸­æ‹–è¿‡å»

ç»™JumpçŠ¶æ€æ·»åŠ åˆ‡æ¢åˆ°BlueLandçš„æ¡ä»¶ï¼Œå½“è½åœ°åŠ¨ç”»æ’­æ”¾å®Œæ¯•æ—¶ï¼ŒåŠ¨ç”»åˆ‡æ¢åˆ°BlueIdleçŠ¶æ€ï¼š

- å‹¾é€‰ Has Exit Time ï¼ˆè®©åŠ¨ç”»æœ‰ä¸ªè¿‡æ¸¡æ•ˆæœï¼‰
- ExitTimeè®¾ç½®ä¸º1
- å–æ¶ˆå‹¾é€‰Fixed Duration
- Transition Duration è®¾ç½®ä¸º0

è¿æ¥isGroundå‚æ•°åˆ°åŠ¨ç”»å‚æ•°

```c#
public class PlayerAnimation : MonoBehaviour
{
    // å¢åŠ ç‰©ç†æ£€æŸ¥
    private PhysicsCheck physicsCheck;

    private void Awake() {
        physicsCheck = GetComponent<PhysicsCheck>();
    }

    public void SetAnimation() {
        anim.SetBool("isGround", physicsCheck.isGround);
    }
}

```

#### æ‰“æ–­è½åœ°åŠ¨ç”»

å¦‚æœè½åœ°è·‘æ­¥çš„è¯ï¼Œä¹Ÿè¦ç­‰è½åœ°åŠ¨ç”»æ’­æ”¾å®Œã€‚å¸Œæœ›æ‰“æ–­è¿™ä¸ªè½åœ°åŠ¨ç”»ã€‚

å°†BlueLandçŠ¶æ€è¿æ¥åˆ°Exitï¼Œæ¡ä»¶æ˜¯velocityXå¤§äº0.1 

#### æœ¬èŠ‚å®Œæ•´ä»£ç 

åŠ¨ç”»çª—å£å¦‚ä¸‹

<img src="./images/image-20230402111740831.png" alt="image-20230402111740831" style="zoom:67%;" />

å®Œæ•´ä»£ç å¦‚ä¸‹

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerAnimation : MonoBehaviour
{
    // Start is called before the first frame update
    public Animator anim;

    private Rigidbody2D rb;
    private PhysicsCheck physicsCheck;

    private void Awake() {
        anim = GetComponent<Animator>();
        rb = GetComponent<Rigidbody2D>();
        physicsCheck = GetComponent<PhysicsCheck>();
    }
    private void Update() {
        SetAnimation();
    }
    public void SetAnimation() {
        anim.SetFloat("velocityX", Mathf.Abs(rb.velocity.x));
        anim.SetFloat("velocityY", rb.velocity.y);
        anim.SetBool("isGround", physicsCheck.isGround);
    }
}

```

### 9.å®ç°äººç‰©ä¸‹è¹²é€»è¾‘å’ŒåŠ¨ç”»

[Unity - Scripting API: Animator (unity3d.com)](https://docs.unity3d.com/2022.2/Documentation/ScriptReference/Animator.html)

![image-20230402113915345](./images/image-20230402113915345.png)

æ€è·¯ï¼š

- åˆ›å»ºåŠ¨ç”»
- åˆ›å»ºæŒ‰é”®ç»‘å®šè®¾å®šisCrouchå‚æ•°
- è¿æ¥isCrouchå‚æ•°åˆ°åŠ¨ç”»é‡Œçš„å‚æ•°
- æŒ‰ä½æ—¶ä¸‹è¹²ï¼Œä¸æŒ‰ä½æ—¶å›åˆ°åˆå§‹çŠ¶æ€

è¿˜éœ€è¦å¤šåˆ›å»ºä¸€ä¸ªåŠ¨ç”»ï¼Œä½¿å¾—æŒ‰ä½ä¸åŠ¨æ—¶åªæ’­æ”¾ä¸€ä¸ªåŠ¨ç”»

æˆ‘è‡ªå·±å®ç°äº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¦‚ä¸‹

<img src="./images/image-20230402120311767.png" alt="image-20230402120311767" style="zoom:67%;" />

æ·»åŠ äº†ä¸€ä¸ªå˜é‡isCrouchï¼Œå½“æŒ‰ä½æ—¶å…ˆè½¬åˆ°BlueCrouchçŠ¶æ€ï¼Œæ’­æ”¾å®ŒåŠ¨ç”»ä»¥åè½¬åˆ°BlueCrouchIdle

ä½†æ˜¯ä¸ºäº†å­¦ä¹ Unityçš„æ–°åŠŸèƒ½ã€‚è¿™é‡Œå…ˆåˆ æ‰BlueCrouchIdleå’ŒBlueCrouch

å³é”®Animatorä¸­çš„ç©ºç™½ä½ç½®ï¼Œåˆ›å»ºSub-State Machine

<img src="./images/image-20230402120535711.png" alt="image-20230402120535711" style="zoom:67%;" />

åŒå‡»è¿›å…¥

è°ƒæˆä¸‹é¢è¿™æ ·

<img src="./images/image-20230403184626025.png" alt="image-20230403184626025" style="zoom:67%;" />

ä¹Ÿå¯ä»¥è¿æ¥åˆ°**Base Layer**ï¼Œè¿˜èƒ½æŒ‡å®šè¿›å…¥åˆ°å¤–é¢çš„å“ªä¸€å±‚ã€‚

#### ä»£ç è°ƒæ•´

`PlayerController.cs`

> ä»¥è€å¸ˆæ”¹çš„ä¸ºä¸»ï¼Œè®°å½•è‡ªå·±çš„æ€è·¯

è‡ªå·±æ”¹çš„

```c#
// è‡ªå·±æ”¹çš„
public class PlayerController : MonoBehaviour
{
    // ä¸‹è¹²çŠ¶æ€
    public bool isCrouch;
    private void Awake()
    {
        #region ä¸‹è¹²
        inputControl.Gameplay.Crouch.performed += (InputAction.CallbackContext ctx) => {
            isCrouch = true;
        };

        inputControl.Gameplay.Crouch.canceled += (InputAction.CallbackContext ctx) => {
            isCrouch = false;
        };
        #endregion
    }
}
```

è€å¸ˆæ”¹çš„

```c#
public class PlayerController : MonoBehaviour
{
    public void Move() {
        // ...
        isCrouch = inputDirection.y < -0.5f && physicsCheck.isGround;
    }
    
}
```

å¥½å¤„æ˜¯ä¸éœ€è¦æ·»åŠ æ–°çš„æŒ‰é”®æ£€æµ‹ï¼Œè€Œä¸”ä»£ç ç®€çŸ­ã€‚

`PlayerController.cs`

```c#
public class PlayerAnimation : MonoBehaviour
{
    private PlayerController playerController;

    private void Awake() {
        playerController = GetComponent<PlayerController>();
    }
    public void SetAnimation() {
        anim.SetBool("isCrouch", playerController.isCrouch);
    }
}
```

#### ä¸‹è¹²æ—¶ä¿®æ”¹ç¢°æ’ä½“

ä¹‹å‰æ”¹å®Œåï¼Œç¢°æ’ä½“æ²¡æœ‰å˜åŒ–ï¼Œä¸‹è¹²æ—¶å¸Œæœ›ç¢°æ’ä½“ä¹Ÿå‘ç”Ÿå˜åŒ–ã€‚

`PlayerController.cs`

```c#
public class PlayerController : MonoBehaviour
{
    // è·å–ç¢°æ’ä½“
    private CapsuleCollider2D coll;  // ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ Collider2D
    // ...
    private void Awake()
    {
        // ...
        coll = GetComponent<CapsuleCollider2D>();
        // è·å¾—ç¢°æ’ä½“çš„åˆå§‹çŠ¶æ€
        orginalOffset = coll.offset;
        orginalSize = coll.size;
    }
    public void Move() {
        // ...
        isCrouch = inputDirection.y < -0.5f && physicsCheck.isGround;
    
        if (isCrouch)
        {
            // ä¿®æ”¹ç¢°æ’ä½“å¤§å°å’Œä½ç§»
            coll.offset = new Vector2(-0.05f, 0.85f);
            coll.size = new Vector2(0.7f, 1.7f);
        }
        else
        {
            // è¿˜åŸ
            coll.offset = orginalOffset;
            coll.size = orginalSize;
        }
    }
}
```

å¯é€‰ï¼Œä¸‹è¹²æ—¶é™åˆ¶äººç‰©ç§»åŠ¨ã€‚

```c#
if (!isCrouch)
{
    ...
}
```



#### å®Œæ•´ä»£ç 

- [PlayerAnimation_2_9.cs](src/PlayerAnimation_2_9.cs)
- [PlayerController_2_9.cs](src/PlayerController_2_9.cs)

### 10.äººç‰©å±æ€§åŠä¼¤å®³è®¡ç®—

æ•Œäººç´ ææ–‡ä»¶å¤¹ï¼š`Assets/Art Assets/Legacy-Fantasy-High Forest/Enemies/Boar`

åŒæ ·ï¼Œéœ€è¦å¯¹ç´ æè¿›è¡Œåˆ‡å‰²ã€‚

æ‹–åŠ¨çš„æ—¶å€™æŒ‰ä½ctrlé”®å¯ä»¥æŒ‰ç…§ä¸€å®šçš„æ ¼å­æ‹–åŠ¨å¯¹è±¡ã€‚

ç¢°æ’ä½“è°ƒæˆåªæœ‰è„šåº•é‚£ä¸€å°å—ã€‚åŸå› ï¼šé¿å…æ”»å‡»åˆ¤å®šæ£€æµ‹èŒƒå›´å¤ªå¤§ã€‚

å¸Œæœ›äººç‰©å¯ä»¥ç©¿è¶Šé‡çŒªï¼Œç©¿è¿‡é‡çŒªæ—¶äººç‰©å—ä¼¤ã€‚ï¼ˆIs Triggerï¼‰

æ·»åŠ 2ä¸ªæ–°çš„Layerï¼ŒPlayerå’ŒEnemyã€‚å¹¶ç»™Playerå’ŒLayerè®¾ç½®å›¾å±‚ï¼Œå‰”é™¤äººç‰©å’Œé‡çŒªçš„ç¢°æ’ï¼ŒåŒæ—¶ä¹Ÿå‰”é™¤äº†æ•Œäººä¹‹é—´çš„ç¢°æ’

<img src="./images/image-20230403194842374.png" alt="image-20230403194842374" style="zoom:67%;" />

åˆ›å»ºé‡çŒªå¯¹è±¡ã€‚

- ç»™é‡çŒªå¯¹è±¡æ·»åŠ åˆšä½“
- æ·»åŠ Boxç¢°æ’ä½“ï¼Œè®¾ç½®ç¢°æ’ä½“çš„Exclude Layers
- æ·»åŠ èƒ¶å›Šç¢°æ’ä½“ï¼Œå‹¾é€‰Is Trigger
- è°ƒæ•´å¥½ç¢°æ’ä½“çš„å¤§å°

<img src="./images/image-20230403195633638.png" alt="image-20230403195633638" style="zoom:67%;" />

åœ¨`PlayerController.cs`ä¸­ç¼–å†™æµ‹è¯•ä»£ç 

```c#
    // æµ‹è¯•
    private void OnTriggerStay2D(Collider2D other) {
        Debug.Log(other.name);
    }
```

æµ‹è¯•å®Œæ¯•åæ³¨é‡Šæ‰

åˆ›å»º`Assets/Scripts/General`

```
|-General
  |-Attack.cs
  |-Character.cs
  |-PhysicsCheck.cs
```

ç¼–å†™`Attack.cs`

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Attack : MonoBehaviour
{
    public int damage;
    public int attackRange;
    public int attackRate;

    private void OnTriggerStay2D(Collider2D other) {
        // Debug.Log(other.name);
        // å°‘åŠ ä¸€ä¸ªé—®å·
        other.GetComponent<Character>()?.TakeDamage(this);
    }
}

```

ç¼–å†™`Character.cs`

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Character : MonoBehaviour
{
    [Header("åŸºæœ¬å±æ€§")]
    public float maxHealth;
    public float currentHealth;

    [Header("å—ä¼¤æ— æ•Œ")]
    public float invulnerableDuration;
    private float invulnerableCounter;
    public bool invulnerable;
    // Start is called before the first frame update
    private void Start()
    {
        currentHealth = maxHealth;
    }
    private void Update()
    {
        if (invulnerable)
        {
            //Time.deltaTime: å®Œæˆä¸Šä¸€å¸§æ‰€ç”¨çš„æ—¶é—´(s)
            invulnerableCounter -= Time.deltaTime;
            if (invulnerableCounter <= 0)
            {
                invulnerable = false;
            }
        }
    }
    // Update is called once per frame
    public void TakeDamage(Attack attacker)
    {
        if (invulnerable)
            return;
        
        if (currentHealth - attacker.damage > 0)
        {
            currentHealth -= attacker.damage;
            TriggerInvulnerable();
        }
        else
        {
            currentHealth = 0;
            // è§¦å‘æ­»äº¡
        }
        
    }

    private void TriggerInvulnerable()
    {
        if (!invulnerable)
        {
            invulnerable = true;
            invulnerableCounter = invulnerableDuration;
        }
    }
}

```

æŒ‚è½½`Character`ç»„ä»¶åˆ°Player

æŒ‚è½½`Character`ï¼Œ`Attack`ç»„ä»¶åˆ°Boar

è®¾ç½®åˆå§‹å±æ€§

```
# player
MaxHealth 100
CurrentHealth 100
InvulnerableDuration 2
# boar
MaxHealth 50
CurrentHealth 50
Damage 5
```

### 11.å—ä¼¤å’Œæ­»äº¡çš„é€»è¾‘å’ŒåŠ¨ç”»

å—ä¼¤çš„åŠ¨ç”»

<img src="./images/image-20230404200231399.png" alt="image-20230404200231399" style="zoom:67%;" />

æ­»äº¡çš„åŠ¨ç”»

<img src="./images/image-20230404200246313.png" alt="image-20230404200246313" style="zoom:67%;" />



å—ä¼¤çš„åŠ¨ç”»å‘½åä¸º`BlueHurt.anim`ï¼Œæ­»äº¡çš„åŠ¨ç”»å‘½åä¸º`BlueDeath.anim`

åˆ›å»ºå¥½è¿™ä¸¤ä¸ªåŠ¨ç”»ï¼Œè®¾ç½®Samplesé‡‡æ ·ä¸º14

ç©å®¶åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¯èƒ½è¿›å…¥å—ä¼¤çŠ¶æ€ã€‚

å—ä¼¤æ—¶é—ªçƒï¼Œä»£è¡¨äººç‰©æ­¤æ—¶æ— æ•Œã€‚

åšæ³•ï¼šåœ¨Animatorçª—å£çš„Layeré€‰é¡¹å¡ä¸­æ–°å¢ä¸€å±‚Layer

<img src="./images/image-20230404201023516.png" alt="image-20230404201023516" style="zoom:67%;" />

æ­¤æ—¶çš„Blendingæ–¹å¼æ˜¯â€œOverriderâ€ï¼Œweightè°ƒå¤§ä¼šè¦†ç›–Base Layerå±‚

ä¿®æ”¹Blendingä¸ºAdditive ï¼ˆå åŠ ï¼‰ï¼ŒWeightè°ƒåˆ°1

åˆ›å»ºä¸€ä¸ªæ–°çš„å—ä¼¤ç‰‡æ®µï¼Œèµ·åä¸º`BlueHurt2.anim`

é€‰æ‹©Add Propertyï¼ŒæŠŠäººç‰©çš„é¢œè‰²æ”¾ä¸Šå»

> åŠ¨ç”»ä¹Ÿå¯ä»¥ä¿®æ”¹äººç‰©çš„å¤§å°ã€é¢œè‰²ç­‰å±æ€§ã€‚

é€šè¿‡ä¿®æ”¹äººç‰©é€æ˜åº¦çš„æ–¹å¼åˆ¶ä½œäººç‰©é—ªçƒæ•ˆæœã€‚

- Samplesè®¾ç½®ä¸º6
- ç¬¬äºŒå¸§çš„ä½ç½®é™ä½é€æ˜åº¦
- ç¬¬å››å¸§é€æ˜åº¦è¿˜æ„¿ä¸º1
- ç¬¬å…­å¸§é™ä½é€æ˜åº¦

åœ¨Hurt Layerä¸­è¿æ¥çŠ¶æ€è½¬ç§»å…³ç³»

![image-20230404202355970](./images/image-20230404202355970.png)

åœ¨animatorçš„å‚æ•°Parametersä¸­æ·»åŠ ä¸€ä¸ªè§¦å‘å™¨Triggerï¼Œå‘½åä¸ºhurt

è¿›å…¥BlueHurt2çš„æ¡ä»¶å°±æ˜¯è¿™ä¸ªTrigger

<img src="./images/image-20230404202252503.png" alt="image-20230404202252503" style="zoom:67%;" />

ç„¶åé€€å‡ºæ¡ä»¶ä¸ç”¨è®¾ç½®ï¼Œå½“åŠ¨ç”»æ’­æ”¾å®Œæ—¶é€€å‡ºã€‚

åœ¨`PlayerAnimation.cs`ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªè®¾ç½®è§¦å‘å™¨çš„æ–¹æ³•ã€‚

```c#
public class PlayerAnimation : MonoBehaviour
{
    public void PlayHurt()
    {
        anim.SetTrigger("hurt");
    }
}
```

è¿™é‡Œéœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼š**Unityäº‹ä»¶**

å°±æ˜¯å½“äººç‰©å—ä¼¤æ—¶ï¼Œå¸Œæœ›è§¦å‘ä¸€ç³»åˆ—äº‹ä»¶ã€‚æ€æ ·æ–¹ä¾¿åœ°ç¼–å†™ä»£ç å‘¢ï¼Ÿ

é¦–å…ˆ`Character.cs`å†…

```c#
// å¼•å…¥
using UnityEngine.Events;
public class Character : MonoBehaviour
{
    //...
    // åˆ›å»ºå—ä¼¤äº‹ä»¶
    public UnityEvent<Transform> OnTakeDamage;
    // ...
    public void TakeDamage(Attack attacker)
    {
        if (invulnerable)
            return;
        
        if (currentHealth - attacker.damage > 0)
        {
            currentHealth -= attacker.damage;
            TriggerInvulnerable();
            // æ‰§è¡Œæ³¨å†Œçš„æ‰€æœ‰å—ä¼¤ç›¸å…³çš„æ–¹æ³•
            OnTakeDamage?.Invoke(attacker.transform);
        }
        else
        {
            currentHealth = 0;
            // è§¦å‘æ­»äº¡
        }
        
    }
}

```

ç„¶åå›åˆ°Playerèº«ä¸ŠæŒ‚è½½çš„ç»„ä»¶ï¼Œè®¾ç½®äº‹ä»¶å…³è”çš„æ–¹æ³•ã€‚

<img src="./images/image-20230404203553256.png" alt="image-20230404203553256" style="zoom:67%;" />

æ­¤æ—¶å¯åŠ¨æ¸¸æˆï¼Œäººç‰©ç¢°åˆ°é‡çŒªåå°±ä¼šé—ªçƒäº†ã€‚

å¯é€‰æ“ä½œï¼š

- å°†BlueHurt2çŠ¶æ€æ’­æ”¾çš„åŠ¨ç”»æ”¹ä¸ºBlueHurtåŠ¨ç”»
- ä¸ºBlueHurtåŠ¨ç”»æ·»åŠ äººç‰©å˜æˆçº¢è‰²çš„åŠ¨ç”»æ•ˆæœã€‚

#### äººç‰©å—åˆ°æ”»å‡»åè¢«åå¼¹

åœ¨`PlayerController.cs`ä¸­

```c#
public class PlayerController : MonoBehaviour
{
    // åå¼¹çš„åŠ›
    public float hurtForce;
    // å—ä¼¤åˆ¤æ–­å˜é‡
    public bool isHurt;
    
    public void GetHurt(Transform attacker)
    {
        isHurt = true;
        rb.velocity = Vector2.zero;
        Vector2 dir = new Vector2((transform.position.x - attacker.position.x), 0).normalized;

        rb.AddForce(dir * hurtForce, ForceMode2D.Impulse);
    }
    
    // å¦‚æœäººç‰©å—ä¼¤ï¼Œåˆ™æ— æ³•è¿›è¡Œç§»åŠ¨
    private void FixedUpdate() {
        if (!isHurt)
            Move();
    }
}
```

å…³é”®`GetHurt`åˆ°å—ä¼¤äº‹ä»¶

hurtForce åˆå§‹å€¼è®¾ç½®ä¸º 8

æ­¤æ—¶è°ƒè¯•å‘ç°ï¼Œäººç‰©ä¸€ç›´æ˜¯å—ä¼¤çŠ¶æ€ï¼Œè¢«å¼¹èµ°å°±å›ä¸æ¥äº†ã€‚

è¿™é‡Œåˆè¦å­¦ä¹ ä¸€ä¸ªæ–°çŸ¥è¯†ç‚¹ã€‚

åœ¨Animatorä¸­é€‰ä¸­BlueHurt2çŠ¶æ€ï¼Œå¯ä»¥é€‰æ‹©`Add Behaviour`

åˆ›å»ºä¸€ä¸ªåä¸º`HurtAnimation`çš„ä»£ç å¹¶ç§»åŠ¨åˆ°`Assets/Scripts/Player`ä¸‹

åŒå‡»æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰å¾ˆå¤šå†™å¥½çš„æ¨¡æ¿ã€‚

å…¶ä¸­

```c#
// è¡¨ç¤ºè¿›å…¥çŠ¶æ€æ—¶æ‰§è¡Œè¿™ä¸ªæ–¹æ³•
OnStateEnter;
    
// åŠ¨ç”»æŒç»­æ‰§è¡Œæ—¶
OnStateUpdate;

// çŠ¶æ€é€€å‡ºæ—¶
OnStateExit;
```

æˆ‘ä»¬çš„ç›®çš„æ˜¯ï¼Œå½“å—ä¼¤åŠ¨ç”»æ’­æ”¾å®Œæ¯•æ—¶ï¼Œè®¾ç½®`isHurt`ä¸ºfalseå³å¯

```c#
public class HurtAnimation : StateMachineBehaviour
{
    // OnStateExit is called when a transition ends and the state machine finishes evaluating this state
    override public void OnStateExit(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
    {
        animator.GetComponent<PlayerController>().isHurt=false;
    }
}

```

#### äººç‰©æ­»äº¡

æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

- å°†Hurt Layerçš„Blendingæ–¹å¼æ”¹å›override
- æ·»åŠ ä¸€ä¸ªæ–°çš„å¸ƒå°”å‚æ•° `isDeath`
- å°†BlueDeathåŠ¨ç”»æ‹–æ‹½åˆ°Hurt Layerå†…
- è¿æ¥Any Stateåˆ°BlueDeathï¼Œæ¡ä»¶ä¸º isDeath = trueï¼Œè®°å¾—å–æ¶ˆå‹¾é€‰Can Transition To Self
- è¿æ¥BlueDeathåˆ°Exitï¼Œæ¡ä»¶ä¸ºisDeath = false

ä¿®æ”¹`Character.cs`

```c#
public class Character : MonoBehaviour
{
    // æ³¨å†Œæ­»äº¡äº‹ä»¶
    public UnityEvent OnDie;
    public void TakeDamage(Attack attacker)
    {
        // ...
        else
        {
            currentHealth = 0;
            // è§¦å‘æ­»äº¡
            OnDie?.Invoke();
        }
        
    }
}
```

ä¿®æ”¹`PlayerController.cs`

```c#
public class PlayerController : MonoBehaviour
{
    public bool isDead;
    public void PlayerDead()
    {
        isDead = true;
        inputControl.Gameplay.Disable(); // ä¸ç»™ç©å®¶æ“ä½œäº†
    }
}
```

ä¿®æ”¹`PlayerAnimation.cs`

```c#
public class PlayerAnimation : MonoBehaviour
{
    public void SetAnimation() {
        // ...
        anim.SetBool("isDead", playerController.isDead);
    }
}
```



å…³è”äº‹ä»¶åˆ°æ­»äº¡çŠ¶æ€

<img src="./images/image-20230404211329641.png" alt="image-20230404211329641" style="zoom:67%;" />

è®¾ç½®`BlueDead`åŠ¨ç”»ä¸ºå•æ¬¡æ‰§è¡Œï¼Œæ‰¾åˆ°åŠ¨ç”»ç‰‡æ®µï¼Œå–æ¶ˆå‹¾é€‰Loop Timeå³å¯

<img src="./images/image-20230404211448870.png" alt="image-20230404211448870" style="zoom:67%;" />

æ­»äº¡é¿å…æ•Œäººå†æ¬¡æ”»å‡»ï¼Œåœ¨CheckStateå‡½æ•°ä¸­åŠ å…¥

```c#
private void CheckState()
    {
        if (isDead)
            gameObject.layer = LayerMask.NameToLayer("Enemy");
        else
            gameObject.layer = LayerMask.NameToLayer("Player");
    }
```



#### å®Œæ•´ä»£ç 

- [PlayerAnimation_2_11.cs](./src/PlayerAnimation_2_11.cs)
- [PlayerController_2_11.cs](./src/PlayerController_2_11.cs)
- [HurtAnimation_2_11.cs](./src/HurtAnimation_2_11.cs)

### ä¸‰æ®µæ”»å‡»åŠ¨ç”»çš„å®ç°

#### åŠ¨ç”»è®¾ç½®

æ™®é€šæ”»å‡»å’Œè¿å‡»

![image-20230405131716063](./images/image-20230405131716063.png)

æš´å‡»

![image-20230405131656807](./images/image-20230405131656807.png)

ä¸ºè¿™ä¸‰ç§æ”»å‡»åˆ›å»ºåŠ¨ç”»ã€‚å‘½åä¸º`BlueAttack1.anim`ã€`BlueAttack2.anim`ã€`BlueAttackCritical.anim`

åˆ›å»ºä¸€ä¸ªæ–°çš„Layerï¼Œå‘½åä¸º**Attack Layer**

åˆ›å»ºæ–°çš„å‚æ•°ï¼š

- isAttackï¼š bool
- attackTriggerï¼š bool
- comboï¼šint

> è€å¸ˆæ˜¯ç›´æ¥ç”¨attackå‘½åtriggerçš„ï¼Œæˆ‘è§‰å¾—åŠ ä¸Šä¸€ä¸ªtriggeræ„ä¹‰ä¼šæ›´æ˜ç¡®

åˆ›å»ºä¸€ä¸ªç©ºçš„stateï¼ˆNew Stateï¼‰

è®¾ç½®è¿æ¥`New State` -> `BlueAttack1` -> `BlueAttack2` -> `BlueAttackCritical`

ä¸‰ä¸ªè¿æ¥çš„æ¡ä»¶è®¾ç½®å¦‚ä¸‹

![image-20230405133516642](./images/image-20230405133516642.png)

> æ³¨æ„è¿™é‡Œåé¢ä¸¤ä¸ªè¿æ¥çš„è®¾ç½®ï¼Œcomboéƒ½æ˜¯å¤§äº1å³å¯ã€‚

è¿æ¥çš„è¿‡æ¸¡è®¾ç½®å¦‚ä¸‹

`BlueAttack1` -> `BlueAttack2` å’Œ`BlueAttack2` -> `BlueAttackCritical`éƒ½æ˜¯

- Has Exit Time âœ…
- Exit Timeè®¾ç½®ä¸º0.9

ç„¶åè®¾ç½®è¿™ä¸‰ä¸ªæ”»å‡»åŠ¨ç”»è¿æ¥åˆ° Exitï¼Œè®¾ç½®ä¸ºï¼š

- Has Exit Time âœ…
- Exit Timeè®¾ç½®ä¸º1

ä¸Šé¢çš„è®¾ç½®æ„ä¹‰åœ¨äºï¼Œå¦‚æœåœ¨æ”»å‡»åŠ¨ç”»æ’­æ”¾ä¸­ï¼ŒæŒ‰ä¸‹äº†æ”»å‡»é”®ï¼Œé‚£ä¹ˆè®¡æ•°å™¨ä¼š+1ï¼Œç„¶åè½¬åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ä½†æ˜¯å¦‚æœæ²¡æŒ‰æ”»å‡»é”®ï¼ŒåŠ¨ç”»æ’­æ”¾å®Œäº†ï¼Œå°±é€€å‡ºæ”»å‡»çŠ¶æ€ã€‚

è®¾ç½®å®Œæ¯•å

<img src="./images/image-20230405134407231.png" alt="image-20230405134407231" style="zoom:67%;" />

#### æ·»åŠ æ”»å‡»æŒ‰é’®

`Settings/Input System/PlayerInputControl`

<img src="./images/image-20230405134558913.png" alt="image-20230405134558913" style="zoom:67%;" />

#### ä»£ç ä¿®æ”¹

è°ƒè¯•åå‘ç°comboå‚æ•°ä¸å¥½ç”¨ï¼Œç›´æ¥åˆ æ‰

`PlayerController.cs`

```c#
public class PlayerController : MonoBehaviour
{
    // æ”»å‡»è®¡æ•°å™¨
    // public int combo;
    // æ˜¯å¦åœ¨æ”»å‡»
    public bool isAttack;
    // ...
    private PlayerAnimation playerAnimation;
    private void Awake()
    {
        playerAnimation = GetComponent<PlayerAnimation>();
        // ...
        // æ”»å‡»
        inputControl.Gameplay.Attack.started += PlayerAttack;
    }
    private void PlayerAttack(InputAction.CallbackContext obj) {
        playerAnimation.PlayerAttack();
        isAttack = true;
        // combo++;
        // if (combo >= 3)
        // {
        //     combo = 0;
        // }
    }
}
```

`PlayerAnimation.cs`

```c#
public class PlayerAnimation : MonoBehaviour
{
    public void SetAnimation() {
        anim.SetBool("isAttack", playerController.isAttack);
        // anim.SetInteger("combo", playerController.combo);
    }
    public void PlayerAttack()
    {
        anim.SetTrigger("attackTrigger");
    }
}
```

ä¿®æ”¹åˆ°è¿™é‡Œå°±å¯ä»¥æµ‹è¯•ä»£ç äº†

ä½†æ˜¯å¯ä»¥å‘ç°ï¼Œå¦‚æœæŒ‰é”®å¾ˆå¿«ï¼Œä¸‰æ¬¡æ”»å‡»å®Œæ¯•åé©¬ä¸Šè¿˜ä¼šå†æ”»å‡»ä¸€æ¬¡ã€‚

ç‚¹å‡»Attack1ï¼ŒAdd Behaviourï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„è„šæœ¬`AttackFinish`

```c#
public class AttackFinish : StateMachineBehaviour
{
    override public void OnStateExit(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
    {
       animator.GetComponent<PlayerController>().isAttack = false;
    }
}
```

ç»™æ¯ä¸ªAttackçŠ¶æ€æŒ‚è½½è¿™ä¸ªä»£ç ã€‚

> å…¶å®æˆ‘æ„Ÿè§‰ä¸åŠ è¿™ä¸ªä¹Ÿå¯ä»¥ï¼ŒåŠ è¿™ä¸ªå¯ä»¥æ§åˆ¶æ”»å‡»çš„CDï¼Œä¸èƒ½ä¸€ç›´æ”»å‡»ä¸€ç›´æ”»å‡»ã€‚

### 13.å®è£…æ”»å‡»åˆ¤å®š

å¯ä»¥é€šè¿‡é€å¸§è§‚å¯Ÿæ”»å‡»åŠ¨ç”»å‘ç°ï¼Œç¬¬ä¸‰å¸§æ—¶ï¼Œæ”»å‡»æŒ¥å‡º

<img src="./images/image-20230405211213461.png" alt="image-20230405211213461" style="zoom:67%;" />

æˆ‘ä»¬è¦å®ç°çš„å°±æ˜¯åœ¨ç©å®¶æ”»å‡»æ—¶æ·»åŠ ç¢°æ’ä½“ã€‚ä½†æ˜¯ç©å®¶èº«ä¸Šç»‘å®šå¤ªå¤šç¢°æ’ä½“ä¹Ÿä¸å¥½

è¿™å°±éœ€è¦ç»™ç©å®¶æ·»åŠ å­ç‰©ä½“

<img src="./images/image-20230405211636717.png" alt="image-20230405211636717" style="zoom:67%;" />

ç»™ç¬¬ä¸€æ®µæ”»å‡»æ·»åŠ Polygon Collider 2Dç¢°æ’ä½“ï¼Œå‹¾é€‰`Is Trigger`

> åœ¨Points > Element ä¸­å¯ä»¥æŸ¥çœ‹é¡¶ç‚¹çš„ä½ç½®å¹¶åˆ é™¤é¡¶ç‚¹ã€‚

<img src="./images/image-20230405212424010.png" alt="image-20230405212424010" style="zoom:67%;" />



- ç¼–è¾‘å¥½æ‰€æœ‰äººç‰©æ”»å‡»åŠ¨ä½œçš„ç¢°æ’ä½“ã€‚
- ç»™æ”»å‡»åŠ¨ä½œæ·»åŠ æ”»å‡»è„šæœ¬
- åœ¨åŠ¨ç”»å¸§çª—å£ä¸­ï¼Œè®¾ç½®åœ¨ç¬¬å‡ å¸§çš„æ—¶å€™å‡ºç°äººç‰©çš„æ”»å‡»ç¢°æ’ä½“ã€‚
- è®¾ç½®layerï¼Œé¿å…è‡ªå·±æ”»å‡»åˆ°è‡ªå·±ã€‚
- è®¾ç½®é‡æ€ªçš„èƒ¶å›Šç¢°æ’ä½“çš„Layer Override Priority
- è®¾ç½®é‡æ€ªçš„æ— æ•Œæ—¶é—´ä¸º1ç§’ï¼Œé¿å…è¿ç»­åˆ¤æ–­ã€‚
- è®¾ç½®æ”»å‡»æ—¶äººç‰©ä¸èƒ½ç§»åŠ¨ã€‚
- è®¾ç½®äººç‰©åœ¨åœ°é¢å’Œåœ¨ç©ºä¸­æ—¶ï¼Œæè´¨ä¸ä¸€æ ·ã€‚
  - æ·»åŠ ä¸€ä¸ªæ–°çš„æè´¨ï¼Œæœ‰æ‘©æ“¦åŠ›ã€‚
  - æ·»åŠ ä¸¤ä¸ªå…¬å…±å˜é‡ï¼Œèƒ½é€‰æ‹©æè´¨ã€‚
  - ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦åˆ‡æ¢æè´¨ã€‚

> äººç‰©ç«™ç«‹ä¸åŠ¨ï¼Œæ”»å‡»é‡æ€ªä¸æ‰è¡€ã€‚ä¿®æ”¹Boar Rigibody 2Dä¸­çš„Sleeping Modeä¸ºNever Sleep

#### è®¾ç½®æ”»å‡»æ—¶äººç‰©ä¸èƒ½ç§»åŠ¨

ä¿®æ”¹`PlayerController.cs`

```c#
    private void FixedUpdate() {
        if (!isHurt && !isAttack)
        {
            Move();
        }
    }
```

ä¿®æ”¹`AttackFinish.cs`

```c#
public class AttackFinish : StateMachineBehaviour
{
    // å¯é€‰ï¼Œä¸ä¸€å®šéœ€è¦
    override public void OnStateEnter(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
    {
       animator.GetComponent<PlayerController>().isAttack = true;
    }


    override public void OnStateExit(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)
    {
       animator.GetComponent<PlayerController>().isAttack = false;
    }
```

ä½¿å¾—äººç‰©æ”»å‡»æ—¶ä¸èƒ½å¾€å‰ç§»åŠ¨ï¼Œå¦‚æœä¸ç”¨å¯é€‰éƒ¨åˆ†ï¼Œäººç‰©æ”»å‡»é—´æ­‡è¿˜æ˜¯ä¼šå¾€å‰çªœ

#### è®¾ç½®æè´¨åˆ‡æ¢

ä¿®æ”¹`PlayerController.cs`

```c#
public class PlayerController : MonoBehaviour
{
    [Header("ç‰©ç†æè´¨")]
    public PhysicsMaterial2D normal;
    public PhysicsMaterial2D wall;
    
    private void Update() {
        inputDirection = inputControl.Gameplay.Move.ReadValue<Vector2>();
        
        CheckState();
        
    }
    
    private void CheckState()
    {
        // CapsuleCollider2D
        coll.sharedMaterial = physicsCheck.isGround ? normal : wall;
    }
}
```

