å‚è€ƒï¼š

[LPç¼–è¾‘å™¨-LPå¹³å°åˆ›ä½œä¸­å¿ƒ (lpengine.cn)](http://console.lpengine.cn/)ï¼šè¿™ä¸ªç¼–è¾‘å™¨æ˜¯ç½‘é¡µç‰ˆçš„ï¼Œå› æ­¤æˆ‘æ„Ÿè§‰éœ€è¦ä¸€äº›å‰ç«¯çš„çŸ¥è¯†ã€‚

[åäº”åˆ†é’Ÿåšä¸€ä¸ªæ–‡å­—æ”¾ç½®æ¸¸æˆ](https://zhuanlan.zhihu.com/p/100822441)

[ï¼ˆå†è¿›é˜¶ï¼‰åäº”åˆ†é’Ÿåšä¸€ä¸ªæ–‡å­—æ”¾ç½®æ¸¸æˆ](https://zhuanlan.zhihu.com/p/103082959)



å¤åˆ»ä¸Šé¢çš„å†…å®¹

- unityç‰ˆæœ¬ï¼š2021.3.21

> âœ¨è™½ç„¶æ˜¯å¤åˆ»ä½†æ˜¯ä¼šç®€åŒ–å¾ˆå¤šæ­¥éª¤æè¿°ï¼ŒåŒæ—¶å†…å®¹ä¸Šä¹Ÿè¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼ˆæˆ‘è‡ªè®¤ä¸ºçš„ï¼‰

## æ™®é€šåšæ³•

æ™®é€šåšæ³•æŒ‡çš„æ˜¯æ²¡æœ‰ç”¨ScriptObjectçš„åšæ³•ã€‚åœ¨å­¦ä¹ äº†ScriptObjectä¹‹åï¼Œæˆ‘ä¹Ÿæƒ³å°è¯•ç”¨ScriptObjectåœ¨å®ç°ä¸€æ¬¡ã€‚

### åˆ›å»ºç‰©ä½“

- åœ¨Hierachyçª—å£åˆ›å»ºä¸€ä¸ª **Eat Button**ï¼Œç”¨äºç‚¹å‡»ååƒè‹¹æœ
  - Mining Buttonè‡ªå¸¦ä¸€ä¸ª Textï¼Œé‡å‘½åä¸º **Eat Button Text**
- åˆ›å»ºä¸€ä¸ª **Exp Text**ï¼Œç”¨äºæ˜¾ç¤ºå½“å‰ç»éªŒå€¼
- åˆ›å»ºä¸€ä¸ª **Apple Text**ï¼Œç”¨äºæ˜¾ç¤ºå½“å‰è‹¹æœæ•°é‡
- åˆ›å»ºä¸€ä¸ª **Main** ç©ºç‰©ä½“ï¼Œç”¨äºæŒ‚è½½è„šæœ¬

åˆ›å»ºå®Œæ¯•åï¼ŒHierarchyç•Œé¢åº”è¯¥æ˜¯

<img src="./images/image-20230808233648544.png" alt="image-20230808233648544" style="zoom:80%;" />

### ç¼–è¾‘æ–‡æœ¬

æ¥ä¸‹æ¥ç¼–è¾‘å„ä¸ªæ–‡æœ¬çš„åˆå§‹çŠ¶æ€ï¼š

- Eat Button Textï¼š**åƒè‹¹æœï¼ˆè‹¹æœ-1ï¼Œç»éªŒ+5ï¼‰**
- Exp Textï¼š**ç»éªŒå€¼ï¼š0**
- Apple Textï¼š**è‹¹æœæ•°é‡ï¼š0**

æ ¼å¼è°ƒæ•´éšæ„ï¼Œåšå¥½ä»¥åï¼Œå¤§æ¦‚é•¿è¿™æ ·

<img src="./images/image-20230809000749246.png" alt="image-20230809000749246" style="zoom:80%;" />

### ç¼–å†™è„šæœ¬

è„šæœ¬åŠŸèƒ½è¯´æ˜ï¼š

- å˜é‡åˆ›å»º
  - expText ç»éªŒå€¼çš„æ–‡æœ¬
  - appleText è‹¹æœæ•°é‡çš„æ–‡æœ¬
  - exp å½“å‰ç»éªŒå€¼
  - appleNum è‹¹æœæ•°é‡
- addExpå‡½æ•°ï¼Œå®ç°ç‚¹å‡»æŒ‰é’®ï¼Œå¢åŠ ç»éªŒçš„åŠŸèƒ½
- addAppleå‡½æ•°ï¼Œå®ç°å¢åŠ è‹¹æœæ•°é‡çš„åŠŸèƒ½
- åœ¨Start() ä¸­ï¼Œè®¾ç½®æ¯ç§’æ‰§è¡Œä¸€æ¬¡ addAppleå‡½æ•°
  - `InvokeRepeating`

åˆ›å»º`Assets/Scripts/Eat.cs`

```cs
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using TMPro;

public class Eat : MonoBehaviour
{
    public TextMeshProUGUI expText;
    public TextMeshProUGUI appleText;
    int exp;
    int appleNum;

    public void AddExp()
    {
        if (appleNum > 0)
        {
            appleNum -= 1;
            exp += 5;
            expText.text = "ç»éªŒå€¼: " + exp;
            appleText.text = "è‹¹æœæ•°é‡: " + appleNum;
        }
        
    }

    void addApple()
    {
        appleNum += 1;
        appleText.text = "è‹¹æœæ•°é‡: " + appleNum;

    }
    void Start()
    {
        // æ¯1ç§’æ‰§è¡Œä¸€æ¬¡ addAppleæ–¹æ³•
        InvokeRepeating("addApple", 0, 1f);
    }
}

```



### æŒ‚è½½è„šæœ¬

- å°†`Eat.cs`è„šæœ¬æŒ‚è½½åœ¨ Mainç‰©ä½“ä¸Šã€‚
- é…ç½®ä¸¤ä¸ªå…¬å¼€å‚æ•°ï¼š`expText`ï¼Œ`appleText`'
- ç»™**Eat Button**çš„`OnClick()`äº‹ä»¶ç»‘å®š`addApple()`æ–¹æ³•

## ä½¿ç”¨ScriptObject

### å‰æœŸå‡†å¤‡

å°†ä¹‹å‰å†™çš„ `Eat.cs` è„šæœ¬é‡å‘½åä¸º `StatusManager.cs`

åˆ›å»ºæ–°çš„è„šæœ¬æ–‡ä»¶ï¼Œå¤§æ¦‚éœ€è¦çš„è„šæœ¬å¦‚ä¸‹

```
Assets/
  - ScriptableObject/
    - CharacterEventSO.cs
  - Scripts/
    - Character.cs
    - StatusManager.cs
```

åœ¨Hierarchyä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºPlayerç©ºç‰©ä½“ï¼Œå°†ä¹‹å‰çš„ Main ç‰©ä½“æ”¹åä¸º StatusManagerï¼ŒHierarchyçª—å£å¦‚ä¸‹

```
Canvas
 |- Eat Button
 |- Exp Text
 |- Apple Text
EventSystem
StatusManager
Player
```



> ğŸ’¡Player å°±ç›¸å½“äºæˆ‘ä»¬çš„ä¸»è§’äººç‰©ï¼Œèº«ä¸Šæœ‰ç»éªŒå€¼ç­‰å±æ€§ï¼Œä½†æ˜¯äººç‰©å¯ä»¥æœ‰å¾ˆå¤šä¸ªï¼Œå› æ­¤`Character.cs`è„šæœ¬è¦è€ƒè™‘åˆ°æ‰©å±•æ€§ã€‚

### ç¼–å†™äººç‰©è„šæœ¬

ç¼–è¾‘`Character.cs`

```cs
// Character.cs
using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Character : MonoBehaviour
{
    public int initExp;

    [Header("äº‹ä»¶å¹¿æ’­")]
    public CharacterEventSO expChangeEvent;
    private int exp;

    private void Awake() 
    {
        exp = initExp;
    }

    public void AddExp(int addedExp)
    {
        exp += addedExp;
        expChangeEvent.RaiseEvent(exp);
    }
}
```

ç»éªŒå€¼å±æ€§ï¼š

- initExpï¼šé»˜è®¤ä¸º0ï¼Œç”¨äºåˆå§‹åŒ–äººç‰©ç»éªŒ
- expï¼šç§æœ‰å˜é‡ï¼Œäººç‰©çš„ç»éªŒå€¼å±æ€§

**äº‹ä»¶å¹¿æ’­æœºåˆ¶**

```cs
{
    public CharacterEventSO expChangeEvent;
    public void AddExp(int addedExp)
    {
        exp += addedExp;
        expChangeEvent.RaiseEvent(exp);
    }
}

```

å½“ç©å®¶è·å¾—ç»éªŒæ—¶ï¼Œå¹¿æ’­ä¸€ä¸ªç»éªŒå€¼å‘ç”Ÿæ”¹å˜çš„äº‹ä»¶**expChangeEvent.RaiseEvent(exp)**ã€‚

ç›®çš„æ˜¯ä¸ºäº†è®©UIä¸­æ–‡æœ¬éšç€äººç‰©çš„ç»éªŒå˜åŒ–è€Œå˜åŒ–ï¼Œè®©æ§åˆ¶æ–‡æœ¬å˜åŒ–çš„è„šæœ¬æ¥æ”¶åˆ°è¿™ä¸ªäº‹ä»¶ã€‚



### åˆ›å»ºSOæ–‡ä»¶

ç¼–è¾‘`CharacterEventSO.cs`

```cs
// CharacterEventSO.cs
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Events;

[CreateAssetMenu(menuName = "Event/CharacterEventSO")]
public class CharacterEventSO : ScriptableObject
{
    public UnityAction<int> OnEventRaised;
    public void RaiseEvent(int exp)
    {
        OnEventRaised?.Invoke(exp);
    }
}
```

> `?.`æ˜¯C#ä¸­çš„ç©ºå€¼ä¼ é€’è¿ç®—ç¬¦ï¼Œå®ƒå¯ä»¥ç¡®ä¿åªæœ‰å½“`OnEventRaised`ä¸ä¸ºnullæ—¶æ‰è°ƒç”¨å…¶`Invoke`æ–¹æ³•ã€‚

- `OnEventRaised` æ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå¯ä»¥å°†å…¶è§†ä¸ºä¸€ç§ç‰¹æ®Šç±»å‹çš„å¤šæ’­å§”æ‰˜ã€‚è¿™æ„å‘³ç€å¤šä¸ªæ–¹æ³•å¯ä»¥è¢«æ³¨å†Œä¸ºå…¶ç›‘å¬å™¨ï¼Œå½“è¯¥äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œæ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ã€‚

### åˆ›å»ºEvent

åœ¨Projectçª—å£ä¸­ï¼Œåˆ›å»º`Assets/Events`æ–‡ä»¶å¤¹

ç„¶ååˆ›å»ºä¸€ä¸ªCharacterEventSOï¼Œå‘½åä¸º`ExpChangeEvent`

### ç¼–å†™StatusManager.csè„šæœ¬

```cs
// StatusMananger.cs
using UnityEngine;
using TMPro;

public class StatusManager : MonoBehaviour
{
    public TextMeshProUGUI expText;
    public TextMeshProUGUI appleText;
    public Character player;
    [Header("äº‹ä»¶ç›‘å¬")]
    public CharacterEventSO expChangeEvent;
    int appleNum;

    private void Start() {
        expChangeEvent.OnEventRaised += OnExpChange;
        InvokeRepeating("AddApple", 0, 1f);
    }

    public void AddExp()
    {
        if (appleNum > 0)
        {
            appleNum -= 1;
            player.AddExp(5);
            // expText.text = "ç»éªŒå€¼: " + exp;
            OnAppleChange(appleNum);
        }
    }

    private void AddApple()
    {
        appleNum += 1;
        OnAppleChange(appleNum);
    }

    private void OnAppleChange(int appleNum)
    {
        appleText.text = "è‹¹æœæ•°é‡: " + appleNum;
    }

    private void OnExpChange(int exp)
    {
        expText.text = "ç»éªŒå€¼: " + exp;
    }
}

```

