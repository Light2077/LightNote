å®˜æ–¹ç½‘ç«™ï¼šhttps://matplotlib.org/

## åŸºç¡€æ¦‚å¿µ

ç»˜å›¾å­¦ä¹ ï¼Œåœ¨å­¦ä¹ ç»˜å›¾å·¥å…·å‰ï¼Œé¦–å…ˆéœ€è¦äº†è§£å›¾åƒä¸Šæœ‰å“ªäº›å…ƒç´ ã€‚

- **ç”»å¸ƒ**ï¼šFigureï¼Œæ•´å¹…å›¾ï¼Œä¹Ÿå¯ä»¥ç¿»è¯‘æˆå›¾åƒæˆ–è€…å›¾å½¢ï¼Œå¯èƒ½æœ‰å¤šä¸ªå­å›¾
- **å­å›¾**ï¼šAxesï¼ŒæŒ‡çš„æ˜¯ç”»å¸ƒä¸­çš„ä¸€ä¸ªå­å›¾
- **å›¾è¡¨æ ‡é¢˜**ï¼šTitle
- **è¾¹æ¡†çº¿**ï¼šSpineï¼Œå­å›¾çš„è¾¹æ¡†çº¿ï¼Œåˆ†ä¸ºä¸Šä¸‹å·¦å³4ä¸ªè¾¹æ¡†çº¿
- **ç½‘æ ¼çº¿**ï¼šGridï¼Œå­å›¾å†…éƒ¨çš„ç½‘æ ¼çº¿
- **å›¾ä¾‹**ï¼šLegend
- **è½´**ï¼šAxisï¼ŒæŒ‡å­å›¾åæ ‡ç³»ä¸Šçš„ä¸€ä¸ªå•ç‹¬çš„è½´çº¿ï¼Œä¾‹å¦‚ x è½´æˆ– y è½´ã€‚
  - **åæ ‡è½´æ ‡é¢˜**ï¼ˆXè½´ï¼ŒYè½´ï¼‰ï¼šX axis labelï¼ŒY axis label
  - **åˆ»åº¦çº¿**ï¼š
    - ä¸»åˆ»åº¦ï¼šMajor tick
    - ä¸»åˆ»åº¦æ ‡ç­¾ï¼šMajor tick label
    - å‰¯åˆ»åº¦ï¼šMinor tick
    - å‰¯åˆ»åº¦æ ‡ç­¾ï¼šMinor tick label

- **å„ç§ç±»å‹çš„å›¾è¡¨**ï¼šæ¯”å¦‚æŠ˜çº¿å›¾line plotï¼Œæ•£ç‚¹å›¾scatter plot

å¯¹åº”ä¸‹é¢è¿™å¼ å›¾ï¼Œå­¦ä¹ matplotlibï¼Œå°±æ˜¯å­¦ä¹ å¦‚ä½•é€šè¿‡ä»£ç æ“ä½œä¸Šè¿°å…ƒç´ ã€‚

![](images/anatomy.png)

ç†è§£Figureï¼ŒAxeså’ŒAxisä¹‹é—´çš„å…³ç³»ã€‚å®ƒä»¬ä¹‹é—´çš„å…³ç³»å…¶å®æ˜¯ä¸€ä¸ªåŒ…å«å…³ç³»ã€‚

Figure > Axes > Axis

- Figureï¼š==ç”»å¸ƒ==ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½å¾€é‡Œæ”¾ï¼Œæ˜¯æœ€å¤§çš„ä¸œè¥¿ã€‚
- Axesï¼š==å­å›¾==ï¼Œå°±æ¯”å¦‚è¯´å››æ ¼æ¼«ç”»é‡Œçš„å…¶ä¸­ä¸€æ ¼ï¼ŒåŒ…æ‹¬åæ ‡è½´ã€è¾¹æ¡†ç­‰å…ƒç´ ã€‚
- Axisï¼š==åæ ‡è½´==ï¼Œå­å›¾é‡Œé¢çš„å…ƒç´ ä¹‹ä¸€ã€‚

> ğŸ’¡ **Axes** åœ¨è‹±æ–‡ä¸­æ˜¯ **axis(è½´)** çš„å¤æ•°å½¢å¼ã€‚
>
> ä½†åœ¨ Matplotlib ä¸­ï¼Œ**Axes** æŒ‡çš„æ˜¯ä¸€ä¸ªåŒ…å«è®¸å¤š Axisï¼ˆè½´ï¼‰çš„å®¹å™¨
>
> å› æ­¤ï¼Œç”¨å¼•ç”³å«ä¹‰**â€œå­å›¾â€**æ¥è¡¨ç¤ºAxesï¼Œè¿™æ ·æ¯”è¾ƒç›´è§‚ã€‚

### Figure

æ•´ä¸ªç”»å¸ƒå°±æ˜¯ä¸€ä¸ªFigureï¼ŒåŒ…å«äº†å¾ˆå¤šAxes

figureä¹Ÿå¯ä»¥è®¾ç½®æ€»çš„åæ ‡è½´æ ‡ç­¾å’Œæ ‡é¢˜

```python
fig, ax = plt.subplots()
fig.suptitle('hello')
fig.supxlable('xlabel')
fig.supylable('ylabel')
```

### Axes

å¯ä»¥æŠŠè¿™ä¸ªç†è§£ä¸ºç»˜å›¾å¯¹è±¡ï¼ŒåŒ…å«äº†å¾ˆå¤šå…ƒç´ ï¼š

- 2ä¸ªåæ ‡è½´ï¼ŒAxisï¼ŒAxiså¯ä»¥ç†è§£ä¸ºxyåæ ‡è½´ï¼Œå¦‚æœæ˜¯3Dç»˜å›¾ï¼Œå°±åŒ…å«3ä¸ªAxisã€‚
- 1ä¸ªxè½´æ ‡ç­¾ï¼Œé€šè¿‡`ax.set_xlabel()`è®¾ç½®
- 1ä¸ªyè½´æ ‡ç­¾ï¼Œé€šè¿‡`ax.set_ylabel()`è®¾ç½®
- 1ä¸ªæ ‡é¢˜ï¼Œé€šè¿‡`ax.set_title()`è®¾ç½®

## jupyterä¸­çš„é­”æœ¯æ–¹æ³•

åµŒå…¥å›¾è¡¨ï¼Œç›´æ¥æ˜¾ç¤ºåœ¨notebookå†…

```python
%matplotlib inline
```

notebookäº¤äº’çª—å£ï¼Œå¯ä»¥ç›´æ¥æ“ä½œå›¾è¡¨

```python
%matplotlib notebook
```

å¼¹å‡ºå°çª—å£

```python
%matplotlib qt5
```

## ax.transform

### Bboxçš„ä½œç”¨

https://matplotlib.org/stable/api/transforms_api.html#matplotlib.transforms.Bbox

`matplotlib.transforms.Bbox`æ˜¯Matplotlibä¸­çš„ä¸€ä¸ªç±»ï¼Œå®ƒè¡¨ç¤ºå›¾å½¢å¯¹è±¡çš„è¾¹ç•Œæ¡†ã€‚å®ƒæ˜¯ä¸€ä¸ªå››å…ƒç»„ï¼Œç”¨äºè¡¨ç¤ºå·¦ä¸‹è§’å’Œå³ä¸Šè§’çš„åæ ‡ï¼Œå¹¶ç”¨äºåœ¨å›¾å½¢çš„ç©ºé—´å†…å®šä½å’Œå¯¹é½å…ƒç´ ã€‚

ä¸»è¦ä½œç”¨ï¼š

- è®¡ç®—å›¾å½¢çš„ç©ºé—´å¤§å°å’Œä½ç½®
- è®¡ç®—å›¾å½¢çš„äº¤é›†ã€å¹¶é›†ã€åŒ…å«ç­‰å…³ç³»
- åœ¨å›¾å½¢ç©ºé—´ä¸­çš„å®šä½å’Œå¯¹é½

ä½¿ç”¨æ–¹æ³•ï¼š

é¦–å…ˆï¼Œéœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª`Bbox`å¯¹è±¡ï¼š

```python
from matplotlib.transforms import Bbox

bbox = Bbox([[xmin, ymin], [xmax, ymax]])

```

å…¶ä¸­`xmin`ã€`ymin`ã€`xmax`ã€`ymax`åˆ†åˆ«è¡¨ç¤ºå·¦ä¸‹è§’å’Œå³ä¸Šè§’çš„åæ ‡ã€‚

ç„¶åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥æ“ä½œ`Bbox`å¯¹è±¡ï¼š

- `translate`ï¼šç§»åŠ¨è¾¹ç•Œæ¡†
- `scale`ï¼šç¼©æ”¾è¾¹ç•Œæ¡†
- `union`ï¼šè®¡ç®—ä¸¤ä¸ªè¾¹ç•Œæ¡†çš„å¹¶é›†
- `intersection`ï¼šè®¡ç®—ä¸¤ä¸ªè¾¹ç•Œæ¡†çš„äº¤é›†
- `contains`ï¼šåˆ¤æ–­ä¸€ä¸ªè¾¹ç•Œæ¡†æ˜¯å¦å®Œå…¨åŒ…å«å¦ä¸€ä¸ªè¾¹ç•Œæ¡†

å¦å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨`Bbox`å¯¹è±¡æ¥å®šä½å’Œå¯¹é½å›¾å½¢ï¼š

```python
from matplotlib.patches import Rectangle
import matplotlib.pyplot as plt

fig, ax = plt.subplots()
x, y = 1, 1
width, height = 5, 5
# æŒ‰æ•°å€¼ç»˜åˆ¶
rect = Rectangle((x, y), width, height, transform=ax.transData, color='r', alpha=.3)
ax.add_patch(rect)
ax.set_ylim(0, 10)
ax.set_xlim(0, 10)
```

![index](images/index-1676008317378-1.png)

```python
from matplotlib.patches import Rectangle
import matplotlib.pyplot as plt

fig, ax = plt.subplots()
x, y = 0.1, 0.1
width, height = 0.5, 0.5
# æŒ‰æ¯”ä¾‹ç»˜åˆ¶
rect = Rectangle((x, y), width, height, transform=ax.transAxes, color='r', alpha=.3)
ax.add_patch(rect)
ax.set_ylim(0, 10)
ax.set_xlim(0, 10)
```

![index](images/index-1676008331132-3.png)

```python
import matplotlib.pyplot as plt
import matplotlib.transforms as transforms

fig, ax = plt.subplots()
# å±•ç¤ºå›¾ä¾‹
bbox = transforms.Bbox([[0.25, 0.25], [0.75, 0.75]])

ax.annotate("Text", xy=(0.5, 0.5), xycoords='data', 
            bbox=bbox, textcoords='data')

plt.show()
```



### transform



transformçš„ä½œç”¨å°±æ˜¯æŠŠæ•°æ®ç‚¹æ˜ å°„åˆ°åƒç´ ç‚¹ä¸Šã€‚

```python
import numpy as np
import matplotlib.pyplot as plt

fig, ax = plt.subplots(figsize=(3,3))
ax.plot(range(5))
plt.show()

print('åƒç´ è¾¹ç•Œ:', ax.bbox.bounds)
print('æ•°æ®ç‚¹æ˜ å°„:', ax.transData.transform((2, 2)))
print('åæ ‡è½´æ˜ å°„:', ax.transAxes.transform((0.5, 0.5)))
```

é€šè¿‡transformï¼Œä½¿å¾—ç»˜åˆ¶çš„å›¾åƒè‡ªåŠ¨é€‚é…

```python
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.transforms import BboxTransform, Bbox


fig, ax = plt.subplots(figsize=(7,8))
ax.imshow(np.random.randn(30, 50), extent=(0, 1000, -2, 3))
ax.axis('auto')
transform = BboxTransform(
    Bbox.from_extents(0, 0, 2, 2), 
    ax.bbox,
)
rect = plt.Rectangle((0.5, 0.5), 1, 1, ec='r', fc='None', transform=transform)
ax.add_patch(rect)
plt.show()
```

è·å–é€†å˜æ¢çš„transform

```python
transData_r = ax.transData.inverted()
# è¾“å…¥åƒç´ ç‚¹ï¼Œè½¬æ¢ä¸ºæ•°æ®
transData_r.transform([100, 100])
```

### åƒç´ ç‚¹è½¬ä¸ºæ•°å€¼

```python
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.transforms import BboxTransform, Bbox


def plot(rects):
    # é‡‡æ ·ç‡æ˜¯
    # 10000
    fig, ax = plt.subplots(figsize=(3, 3))
    # 0-150é€šé“ 10ç§’
    ax.imshow(np.random.randn(976, 140), extent=(0, 140, 10, 0))
    ax.axis('auto')
    transform = BboxTransform(
        Bbox.from_extents(0, 976, 140, 0), 
        ax.bbox,
    )
    for left, bottom, width, height in rects:
        print(left, bottom, width, height)
        rect = plt.Rectangle((left, bottom), width, height, ec='r', fc='None', transform=transform)
        ax.add_patch(rect)
    plt.show()
    return ax, transform
```

```python
# å¼‚å¸¸æ£€æµ‹ç»“æœ

# å¸§èµ·å§‹å’Œç»“æŸ
frame_start = 200
frame_end = 500
channel_start = 100
channel_end = 120

frame_diff = frame_end - frame_start
channel_diff = channel_end - channel_start

rects = [(channel_start, frame_end, channel_diff, frame_diff)]
ax, transform = plot(rects)
transform_r = transform.inverted()
```

```python
# ä¸­é—´è¿‡ç¨‹ä¼šå¾—åˆ°è¿™ä¸ªçŸ©å½¢æ¡†çš„å…·ä½“åƒç´ ä½ç½®
left, bottom = transform.transform([channel_start, frame_end])
right, top = transform.transform([channel_end, frame_start])

width = right - left
height = top - bottom
print(left, right, bottom, top)
print(width, height)
```

```python
# å·¦ ä¸‹ å³ ä¸Š
print('ax.bbox.bounds:', ax.bbox.bounds)
print('è‡ªå®šä¹‰:', Bbox.from_extents(0, 10000, 140, 0).bounds)
```

```python
# æœ€ç»ˆè¦æ ¹æ®è¿™ä¸ªæ¡†çš„åƒç´ ä½ç½®è¿˜åŸåˆ°æ—¶é—´ç‚¹ã€‚æ—¶é—´: 0-100000, é€šé“: 0-140
# å°çš„æ•°å‘ä¸‹å–æ•´ï¼Œå¤§çš„æ•°å‘ä¸Šå–æ•´
transform2 = BboxTransform(
    ax.bbox,
    Bbox.from_extents(0, 100000, 140, 0), 
)
```

```python
channel_start, point_start = transform2.transform([left, top])
channel_end, point_end = transform2.transform([right, bottom])
print(channel_start, channel_end, point_start, point_end)
```

